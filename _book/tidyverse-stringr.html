<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>第 15 章 正则表达式 | R编程与作图</title>
<meta name="author" content="Suoqin Jin">
<meta name="description" content="library(tidyverse) library(stringr)  15.1 问题 这是一份关于地址信息的数据 ## # A tibble: 8 × 2 ##   No address            ##  &lt;int&gt; &lt;chr&gt;             ## 1   1 Sichuan Univ, Coll Chem    ## 2   2 Sichuan Univ,...">
<meta name="generator" content="bookdown 0.36 with bs4_book()">
<meta property="og:title" content="第 15 章 正则表达式 | R编程与作图">
<meta property="og:type" content="book">
<meta property="og:description" content="library(tidyverse) library(stringr)  15.1 问题 这是一份关于地址信息的数据 ## # A tibble: 8 × 2 ##   No address            ##  &lt;int&gt; &lt;chr&gt;             ## 1   1 Sichuan Univ, Coll Chem    ## 2   2 Sichuan Univ,...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="第 15 章 正则表达式 | R编程与作图">
<meta name="twitter:description" content="library(tidyverse) library(stringr)  15.1 问题 这是一份关于地址信息的数据 ## # A tibble: 8 × 2 ##   No address            ##  &lt;int&gt; &lt;chr&gt;             ## 1   1 Sichuan Univ, Coll Chem    ## 2   2 Sichuan Univ,...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.5.1/transition.js"></script><script src="libs/bs3compat-0.5.1/tabs.js"></script><script src="libs/bs3compat-0.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R编程与作图</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">前言</a></li>
<li class="book-part">R编程基础</li>
<li><a class="" href="baseR-intro-ds.html"><span class="header-section-number">1</span> R语言介绍及资料推荐</a></li>
<li><a class="" href="baseR-install.html"><span class="header-section-number">2</span> 安装与环境配置</a></li>
<li><a class="" href="baseR-objects.html"><span class="header-section-number">3</span> 对象</a></li>
<li><a class="" href="baseR-vectors.html"><span class="header-section-number">4</span> 向量</a></li>
<li><a class="" href="baseR-data-structure.html"><span class="header-section-number">5</span> 数据结构</a></li>
<li><a class="" href="baseR-operators.html"><span class="header-section-number">6</span> 运算符及向量运算</a></li>
<li><a class="" href="baseR-functions.html"><span class="header-section-number">7</span> 函数</a></li>
<li><a class="" href="baseR-functions-adv.html"><span class="header-section-number">8</span> 函数应用</a></li>
<li><a class="" href="baseR-subsetting.html"><span class="header-section-number">9</span> 子集选取</a></li>
<li class="book-part">数据读入与处理</li>
<li><a class="" href="tidyverse-readr.html"><span class="header-section-number">10</span> 读取数据</a></li>
<li><a class="" href="tidyverse-dplyr.html"><span class="header-section-number">11</span> 数据处理</a></li>
<li><a class="" href="tidyverse-dplyr-apply.html"><span class="header-section-number">12</span> dplyr进阶</a></li>
<li><a class="" href="tidyverse-tidyr.html"><span class="header-section-number">13</span> 数据规整1</a></li>
<li><a class="" href="tidyverse-tidyr2.html"><span class="header-section-number">14</span> 数据规整2</a></li>
<li><a class="active" href="tidyverse-stringr.html"><span class="header-section-number">15</span> 正则表达式</a></li>
<li><a class="" href="tidyverse-tibble.html"><span class="header-section-number">16</span> 简单数据框</a></li>
<li><a class="" href="tidyverse-workflow.html"><span class="header-section-number">17</span> 回望tidyverse之旅</a></li>
<li class="book-part">画图</li>
<li><a class="" href="tidyverse-ggplot2-aes.html"><span class="header-section-number">18</span> 数据可视化</a></li>
<li><a class="" href="tidyverse-ggplot2-geom.html"><span class="header-section-number">19</span> ggplot2之几何形状</a></li>
<li><a class="" href="tidyverse-ggplot2-scales.html"><span class="header-section-number">20</span> ggplot2之标度</a></li>
<li><a class="" href="tidyverse-ggplot2-theme.html"><span class="header-section-number">21</span> ggplot2之主题设置</a></li>
<li><a class="" href="tidyverse-ggplot2-guides.html"><span class="header-section-number">22</span> ggplot2之图例系统</a></li>
<li><a class="" href="tidyverse-ggplot2-customize.html"><span class="header-section-number">23</span> ggplot2之扩展内容</a></li>
<li><a class="" href="tidyverse-ggplot2-stat-layer.html"><span class="header-section-number">24</span> ggplot2之统计图层</a></li>
<li><a class="" href="tidyverse-ggplot2-from-layer-to-geom.html"><span class="header-section-number">25</span> ggplot2之从图层到几何形状</a></li>
<li><a class="" href="tidyverse-ggplot2-colors.html"><span class="header-section-number">26</span> ggplot2之数据可视化中的配色</a></li>
<li><a class="" href="tidyverse-ggplot2-override-aes.html"><span class="header-section-number">27</span> ggplot2之控制图例的外观</a></li>
<li><a class="" href="tidyverse-ggplot2-aes-eval.html"><span class="header-section-number">28</span> ggplot2之延迟映射</a></li>
<li><a class="" href="tidyverse-ggplot2-academic.html"><span class="header-section-number">29</span> ggplot2之科研数据可视化</a></li>
<li><a class="" href="tidyverse-ggplot2-gganimate.html"><span class="header-section-number">30</span> ggplot2之让你的数据动起来</a></li>
<li><a class="" href="tidyverse-ggplot2-pass-function-as-parameters.html"><span class="header-section-number">31</span> ggplot2中传递函数作为参数值</a></li>
<li class="book-part">可重复性文档Rmarkdown以及练习</li>
<li><a class="" href="tidyverse-rmarkdown.html"><span class="header-section-number">32</span> 可重复性文档</a></li>
<li><a class="" href="eda-practice.html"><span class="header-section-number">33</span> 一天一练</a></li>
<li class="book-part">GO/KEGG富集分析</li>
<li><a class="" href="GO-KEGG.html"><span class="header-section-number">34</span> GO/KEGG功能富集分析</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="tidyverse-stringr" class="section level1" number="15">
<h1>
<span class="header-section-number">第 15 章</span> 正则表达式<a class="anchor" aria-label="anchor" href="#tidyverse-stringr"><i class="fas fa-link"></i></a>
</h1>
<div class="sourceCode" id="cb627"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org">stringr</a></span><span class="op">)</span></span></code></pre></div>
<div id="问题" class="section level2" number="15.1">
<h2>
<span class="header-section-number">15.1</span> 问题<a class="anchor" aria-label="anchor" href="#%E9%97%AE%E9%A2%98"><i class="fas fa-link"></i></a>
</h2>
<p>这是一份关于地址信息的数据</p>
<pre><code>## # A tibble: 8 × 2
##      No address                      
##   &lt;int&gt; &lt;chr&gt;                        
## 1     1 Sichuan Univ, Coll Chem      
## 2     2 Sichuan Univ, Coll Elect Engn
## 3     3 Sichuan Univ, Dept Phys      
## 4     4 Sichuan Univ, Coll Life Sci  
## 5     6 Sichuan Univ, Food Engn      
## 6     7 Sichuan Univ, Coll Phys      
## 7     8 Sichuan Univ, Sch Business   
## 8     9 Wuhan Univ, Mat Sci</code></pre>
<p><strong>问题</strong>：如何提取<code>Sichuan Univ</code>后面的学院？这需要用到正则表达式的知识。</p>
</div>
<div id="什么是正则表达式" class="section level2" number="15.2">
<h2>
<span class="header-section-number">15.2</span> 什么是正则表达式<a class="anchor" aria-label="anchor" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><i class="fas fa-link"></i></a>
</h2>
<p>我们在word文档或者excel中，经常使用查找和替换, 然而有些情况，word是解决不了的，比如</p>
<ul>
<li>条件搜索
<ul>
<li>统计文中，前面有 “data”, “computer” or “statistical” 的 “analysis”，这个单词的个数</li>
<li>找出文中重复的单词，比如“we love love you”</li>
</ul>
</li>
<li>拼写检查
<ul>
<li>电话号码（邮件，密码等）是否正确格式</li>
<li>日期书写的规范与统一</li>
</ul>
</li>
<li>提取信息
<ul>
<li>提取文本特定位置的数据</li>
</ul>
</li>
<li>文本挖掘
<ul>
<li>非结构化的提取成结构化</li>
</ul>
</li>
</ul>
<p>这个时候就需要用到正则表达式（Regular Expression），这一强大、便捷、高效的文本处理工具。那么，什么是正则表达式呢？简单点说，正则表达式是处理字符串的。复杂点说，正则表达式描述了一种字符串匹配的模式（pattern），通常被用来检索、替换那些符合某个模式(规则)的文本。这种固定的格式的文本，生活中常见的有电话号码、网络地址、邮件地址和日期格式等等。</p>
<p>正则表达式并不是R语言特有的，事实上，几乎所有程序语言都支持正则表达式 (e.g. Perl, Python, Java, Ruby, etc).</p>
<p>R 语言中很多函数都需要使用正则表达式，然而正则表达式不太好学。幸运的是，大神Hadley Wickham开发的stringr包让正则表达式简单易懂，因此今天我们就介绍这个包。本章的内容与《R for data science》第10章基本一致。本章目的教大家写<strong>简单的</strong>正则表示式就行了。</p>
</div>
<div id="字符串基础" class="section level2" number="15.3">
<h2>
<span class="header-section-number">15.3</span> 字符串基础<a class="anchor" aria-label="anchor" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%9F%BA%E7%A1%80"><i class="fas fa-link"></i></a>
</h2>
<div id="字符串长度" class="section level3" number="15.3.1">
<h3>
<span class="header-section-number">15.3.1</span> 字符串长度<a class="anchor" aria-label="anchor" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%95%BF%E5%BA%A6"><i class="fas fa-link"></i></a>
</h3>
<p>想获取字符串的长度，可以使用<code><a href="https://stringr.tidyverse.org/reference/str_length.html">str_length()</a></code>函数</p>
<div class="sourceCode" id="cb629"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_length.html">str_length</a></span><span class="op">(</span><span class="st">"R for data science"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 18</code></pre>
<p>字符串向量，也适用</p>
<div class="sourceCode" id="cb631"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_length.html">str_length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"R for data science"</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1]  1 18 NA</code></pre>
<p>数据框里配合dplyr函数，同样很方便</p>
<div class="sourceCode" id="cb633"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"R for data science"</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_length.html">str_length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>##                    x  y
## 1                  a  1
## 2 R for data science 18
## 3               &lt;NA&gt; NA</code></pre>
</div>
<div id="字符串组合" class="section level3" number="15.3.2">
<h3>
<span class="header-section-number">15.3.2</span> 字符串组合<a class="anchor" aria-label="anchor" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%BB%84%E5%90%88"><i class="fas fa-link"></i></a>
</h3>
<p>把字符串拼接在一起，使用 <code><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c()</a></code> 函数</p>
<div class="sourceCode" id="cb635"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "xy"</code></pre>
<p>把字符串拼接在一起，可以设置中间的间隔</p>
<div class="sourceCode" id="cb637"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, sep <span class="op">=</span> <span class="st">", "</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "x, y"</code></pre>
<div class="sourceCode" id="cb639"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">", "</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "x" "y" "z"</code></pre>
<p>是不是和你想象的不一样，那就<code><a href="https://stringr.tidyverse.org/reference/str_c.html">?str_c</a></code>，或者试试这个</p>
<div class="sourceCode" id="cb641"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">", "</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "x, x" "y, y" "z, z"</code></pre>
<p>用在数据框里</p>
<div class="sourceCode" id="cb643"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"I"</span>, <span class="st">"love"</span>, <span class="st">"you"</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"you"</span>, <span class="st">"like"</span>, <span class="st">"me"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>z <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, sep <span class="op">=</span> <span class="st">"|"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>##      x    y         z
## 1    I  you     I|you
## 2 love like love|like
## 3  you   me    you|me</code></pre>
<p>使用collapse选项，是先组合，然后再转换成单个字符串，大家对比下</p>
<div class="sourceCode" id="cb645"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"|"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "x|a" "y|b" "z|c"</code></pre>
<div class="sourceCode" id="cb647"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">"|"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "xa|yb|zc"</code></pre>
</div>
<div id="字符串取子集" class="section level3" number="15.3.3">
<h3>
<span class="header-section-number">15.3.3</span> 字符串取子集<a class="anchor" aria-label="anchor" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8F%96%E5%AD%90%E9%9B%86"><i class="fas fa-link"></i></a>
</h3>
<p>截取字符串的一部分，需要指定截取的开始位置和结束位置</p>
<div class="sourceCode" id="cb649"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Apple"</span>, <span class="st">"Banana"</span>, <span class="st">"Pear"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "App" "Ban" "Pea"</code></pre>
<p>开始位置和结束位置如果是负整数，就表示位置是从后往前数，比如下面这段代码，截取倒数第3个至倒数第1个位置上的字符串</p>
<div class="sourceCode" id="cb651"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Apple"</span>, <span class="st">"Banana"</span>, <span class="st">"Pear"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op">(</span><span class="va">x</span>, <span class="op">-</span><span class="fl">3</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "ple" "ana" "ear"</code></pre>
<p>也可以进行赋值，如果该位置上有字符，就用新的字符替换旧的字符</p>
<div class="sourceCode" id="cb653"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Apple"</span>, <span class="st">"Banana"</span>, <span class="st">"Pear"</span><span class="op">)</span></span>
<span><span class="va">x</span></span></code></pre></div>
<pre><code>## [1] "Apple"  "Banana" "Pear"</code></pre>
<div class="sourceCode" id="cb655"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "A" "B" "P"</code></pre>
<div class="sourceCode" id="cb657"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Q"</span></span>
<span><span class="va">x</span></span></code></pre></div>
<pre><code>## [1] "Qpple"  "Qanana" "Qear"</code></pre>
</div>
</div>
<div id="使用正则表达式进行模式匹配" class="section level2" number="15.4">
<h2>
<span class="header-section-number">15.4</span> 使用正则表达式进行模式匹配<a class="anchor" aria-label="anchor" href="#%E4%BD%BF%E7%94%A8%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%BF%9B%E8%A1%8C%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D"><i class="fas fa-link"></i></a>
</h2>
<p>正则表示式慢慢会呈现了</p>
<div id="基础匹配" class="section level3" number="15.4.1">
<h3>
<span class="header-section-number">15.4.1</span> 基础匹配<a class="anchor" aria-label="anchor" href="#%E5%9F%BA%E7%A1%80%E5%8C%B9%E9%85%8D"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view()</a></code> 是查看string是否匹配pattern，如果匹配，就高亮显示</p>
<div class="sourceCode" id="cb659"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"pear"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span>string <span class="op">=</span> <span class="va">x</span>, pattern <span class="op">=</span> <span class="st">"an"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [2] │ b&lt;an&gt;&lt;an&gt;a</code></pre>
<p>有时候，我们希望在字符<code>a</code>前后都有字符（即，a处在两字符中间，如rap, bad, sad, wave，spear等等）</p>
<div class="sourceCode" id="cb661"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"pear"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">".a."</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [2] │ &lt;ban&gt;ana
## [3] │ p&lt;ear&gt;</code></pre>
<p>这里的<code>.</code> 代表任意字符。如果向表达.本身呢？</p>
<div class="sourceCode" id="cb663"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"s.d"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="st">"."</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] │ &lt;s&gt;&lt;.&gt;&lt;d&gt;</code></pre>
<div class="sourceCode" id="cb665"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"s.d"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="st">"\\."</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] │ s&lt;.&gt;d</code></pre>
</div>
<div id="锚点" class="section level3" number="15.4.2">
<h3>
<span class="header-section-number">15.4.2</span> 锚点<a class="anchor" aria-label="anchor" href="#%E9%94%9A%E7%82%B9"><i class="fas fa-link"></i></a>
</h3>
<p>希望<code>a</code>是字符串的开始</p>
<div class="sourceCode" id="cb667"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"pear"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"^a"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] │ &lt;a&gt;pple</code></pre>
<p>希望<code>a</code>是一字符串的末尾</p>
<div class="sourceCode" id="cb669"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"pear"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"a$"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [2] │ banan&lt;a&gt;</code></pre>
<div class="sourceCode" id="cb671"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"apple pie"</span>, <span class="st">"apple"</span>, <span class="st">"apple cake"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"^apple$"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [2] │ &lt;apple&gt;</code></pre>
</div>
<div id="字符类与字符选项" class="section level3" number="15.4.3">
<h3>
<span class="header-section-number">15.4.3</span> 字符类与字符选项<a class="anchor" aria-label="anchor" href="#%E5%AD%97%E7%AC%A6%E7%B1%BB%E4%B8%8E%E5%AD%97%E7%AC%A6%E9%80%89%E9%A1%B9"><i class="fas fa-link"></i></a>
</h3>
<p>前面提到，<code>.</code>匹配任意字符，事实上还有很多这种<strong>特殊含义</strong>的字符：</p>
<ul>
<li>
<code>\d</code>: matches any digit.</li>
<li>
<code>\s</code>: matches any whitespace (e.g. space, tab, newline).</li>
<li>
<code>[abc]</code>: matches a, b, or c.</li>
<li>
<code>[^abc]</code>: matches anything except a, b, or c.</li>
</ul>
<div class="sourceCode" id="cb673"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey"</span>, <span class="st">"gray"</span><span class="op">)</span>, <span class="st">"gr[ea]y"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] │ &lt;grey&gt;
## [2] │ &lt;gray&gt;</code></pre>
</div>
<div id="重复" class="section level3" number="15.4.4">
<h3>
<span class="header-section-number">15.4.4</span> 重复<a class="anchor" aria-label="anchor" href="#%E9%87%8D%E5%A4%8D"><i class="fas fa-link"></i></a>
</h3>
<p>控制匹配次数:</p>
<ul>
<li>
<code>?</code>: 0 or 1</li>
<li>
<code>+</code>: 1 or more</li>
<li>
<code>*</code>: 0 or more</li>
</ul>
<div class="sourceCode" id="cb675"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="st">"Roman numerals: MDCCCLXXXVIII"</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"CC?"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] │ Roman numerals: MD&lt;CC&gt;&lt;C&gt;LXXXVIII</code></pre>
<div class="sourceCode" id="cb677"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"X+"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] │ Roman numerals: MDCCCL&lt;XXX&gt;VIII</code></pre>
<p>控制匹配次数:</p>
<ul>
<li>
<code>{n}</code>: exactly n</li>
<li>
<code>{n,}</code>: n or more</li>
<li>
<code>{,m}</code>: at most m</li>
<li>
<code>{n,m}</code>: between n and m</li>
</ul>
<div class="sourceCode" id="cb679"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="st">"Roman numerals: MDCCCLXXXVIII"</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"C{2}"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] │ Roman numerals: MD&lt;CC&gt;CLXXXVIII</code></pre>
<div class="sourceCode" id="cb681"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"C{2,}"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] │ Roman numerals: MD&lt;CCC&gt;LXXXVIII</code></pre>
<div class="sourceCode" id="cb683"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"C{2,3}"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] │ Roman numerals: MD&lt;CCC&gt;LXXXVIII</code></pre>
<ul>
<li>默认的情况，<code>*</code>, <code>+</code> 匹配都是<strong>贪婪</strong>的，也就是它会尽可能的匹配更多</li>
<li>如果想让它不贪婪，而是变得懒惰起来，可以在<code>*</code>, <code>+</code> 加个<code>?</code>
</li>
</ul>
<div class="sourceCode" id="cb685"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="st">"Roman numerals: MDCCCLXXXVIII"</span></span>
<span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"CLX+"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] │ Roman numerals: MDCC&lt;CLXXX&gt;VIII</code></pre>
<div class="sourceCode" id="cb687"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"CLX+?"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] │ Roman numerals: MDCC&lt;CLX&gt;XXVIII</code></pre>
<p>小结一下呢</p>
<div class="inline-figure"><img src="images/regex_repeat.jpg" width="75%"></div>
</div>
<div id="分组与回溯引用" class="section level3" number="15.4.5">
<h3>
<span class="header-section-number">15.4.5</span> 分组与回溯引用<a class="anchor" aria-label="anchor" href="#%E5%88%86%E7%BB%84%E4%B8%8E%E5%9B%9E%E6%BA%AF%E5%BC%95%E7%94%A8"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb689"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ft</span> <span class="op">&lt;-</span> <span class="va">fruit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">ft</span></span></code></pre></div>
<pre><code>##  [1] "apple"        "apricot"      "avocado"      "banana"       "bell pepper" 
##  [6] "bilberry"     "blackberry"   "blackcurrant" "blood orange" "blueberry"</code></pre>
<p>我们想看看这些单词里，有哪些字母是重复两次的，比如<code>aa</code>, <code>pp</code>. 如果用上面学的方法</p>
<div class="sourceCode" id="cb691"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">ft</span>, <span class="st">".{2}"</span>, match <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] │ &lt;ap&gt;&lt;pl&gt;e
##  [2] │ &lt;ap&gt;&lt;ri&gt;&lt;co&gt;t
##  [3] │ &lt;av&gt;&lt;oc&gt;&lt;ad&gt;o
##  [4] │ &lt;ba&gt;&lt;na&gt;&lt;na&gt;
##  [5] │ &lt;be&gt;&lt;ll&gt;&lt; p&gt;&lt;ep&gt;&lt;pe&gt;r
##  [6] │ &lt;bi&gt;&lt;lb&gt;&lt;er&gt;&lt;ry&gt;
##  [7] │ &lt;bl&gt;&lt;ac&gt;&lt;kb&gt;&lt;er&gt;&lt;ry&gt;
##  [8] │ &lt;bl&gt;&lt;ac&gt;&lt;kc&gt;&lt;ur&gt;&lt;ra&gt;&lt;nt&gt;
##  [9] │ &lt;bl&gt;&lt;oo&gt;&lt;d &gt;&lt;or&gt;&lt;an&gt;&lt;ge&gt;
## [10] │ &lt;bl&gt;&lt;ue&gt;&lt;be&gt;&lt;rr&gt;y</code></pre>
<p>发现不是和我们的预想不一样呢。</p>
<p>所以需要用到新技术 <strong>分组与回溯引用</strong>，</p>
<div class="sourceCode" id="cb693"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">ft</span>, <span class="st">"(.)\\1"</span>, match <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] │ a&lt;pp&gt;le
##  [5] │ be&lt;ll&gt; pe&lt;pp&gt;er
##  [6] │ bilbe&lt;rr&gt;y
##  [7] │ blackbe&lt;rr&gt;y
##  [8] │ blackcu&lt;rr&gt;ant
##  [9] │ bl&lt;oo&gt;d orange
## [10] │ bluebe&lt;rr&gt;y</code></pre>
<ul>
<li>
<code>.</code> 是匹配任何字符</li>
<li>
<code>(.)</code> 将匹配项括起来，它就用了一个名字，叫<code>\\1</code>； 如果有两个括号，就叫<code>\\1</code>和<code>\\2</code>
</li>
<li>
<code>\\1</code> 表示回溯引用，表示引用<code>\\1</code>对于的<code>(.)</code>
</li>
</ul>
<p>所以<code>(.)\\1</code>的意思就是，匹配到了字符，后面还希望有个<strong>同样的字符</strong></p>
<p>如果是匹配<code>abab</code>, <code>wcwc</code></p>
<div class="sourceCode" id="cb695"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">ft</span>, <span class="st">"(..)\\1"</span>, match <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [4] │ b&lt;anan&gt;a</code></pre>
<p>如果是匹配<code>abba</code>, <code>wccw</code>呢？</p>
<div class="sourceCode" id="cb697"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">ft</span>, <span class="st">"(.)(.)\\2\\1"</span>, match <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [5] │ bell p&lt;eppe&gt;r</code></pre>
<p>是不是很神奇？</p>
</div>
<div id="大小写敏感" class="section level3" number="15.4.6">
<h3>
<span class="header-section-number">15.4.6</span> 大小写敏感<a class="anchor" aria-label="anchor" href="#%E5%A4%A7%E5%B0%8F%E5%86%99%E6%95%8F%E6%84%9F"><i class="fas fa-link"></i></a>
</h3>
<p>希望找出线上平台是google和meet的记录，显然Google和google是一个意思，都应该被筛选出</p>
<div class="sourceCode" id="cb699"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">tch_id</span>,  <span class="op">~</span><span class="va">online_platform</span>,</span>
<span>      <span class="fl">105</span>,          <span class="st">"Google"</span>,</span>
<span>      <span class="fl">106</span>,            <span class="st">"meet"</span>,</span>
<span>      <span class="fl">107</span>,            <span class="st">"Zoom"</span>,</span>
<span>      <span class="fl">108</span>,            <span class="st">"zoom"</span>,</span>
<span>      <span class="fl">109</span>,     <span class="st">"Google Meet"</span>,</span>
<span>      <span class="fl">112</span>, <span class="st">"Microsoft Teams"</span>,</span>
<span>      <span class="fl">113</span>,                <span class="cn">NA</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">df</span></span></code></pre></div>
<pre><code>## # A tibble: 7 × 2
##   tch_id online_platform
##    &lt;dbl&gt; &lt;chr&gt;          
## 1    105 Google         
## 2    106 meet           
## 3    107 Zoom           
## 4    108 zoom           
## 5    109 Google Meet    
## 6    112 Microsoft Teams
## 7    113 &lt;NA&gt;</code></pre>
<p>方法1，使用<code><a href="https://stringr.tidyverse.org/reference/modifiers.html">stringr::regex()</a></code></p>
<div class="sourceCode" id="cb701"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">online_platform</span>, <span class="fu"><a href="https://stringr.tidyverse.org/reference/modifiers.html">regex</a></span><span class="op">(</span><span class="st">"google|meet"</span>, ignore_case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>   <span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   tch_id online_platform
##    &lt;dbl&gt; &lt;chr&gt;          
## 1    105 Google         
## 2    106 meet           
## 3    109 Google Meet</code></pre>
<p>方法2，使用<code>(?i)</code></p>
<div class="sourceCode" id="cb703"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">online_platform</span>, <span class="st">"(?i)google|meet"</span><span class="op">)</span></span>
<span>   <span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   tch_id online_platform
##    &lt;dbl&gt; &lt;chr&gt;          
## 1    105 Google         
## 2    106 meet           
## 3    109 Google Meet</code></pre>
</div>
</div>
<div id="解决实际问题" class="section level2" number="15.5">
<h2>
<span class="header-section-number">15.5</span> 解决实际问题<a class="anchor" aria-label="anchor" href="#%E8%A7%A3%E5%86%B3%E5%AE%9E%E9%99%85%E9%97%AE%E9%A2%98"><i class="fas fa-link"></i></a>
</h2>
<div id="确定一个字符向量是否匹配一种模式" class="section level3" number="15.5.1">
<h3>
<span class="header-section-number">15.5.1</span> 确定一个字符向量是否匹配一种模式<a class="anchor" aria-label="anchor" href="#%E7%A1%AE%E5%AE%9A%E4%B8%80%E4%B8%AA%E5%AD%97%E7%AC%A6%E5%90%91%E9%87%8F%E6%98%AF%E5%90%A6%E5%8C%B9%E9%85%8D%E4%B8%80%E7%A7%8D%E6%A8%A1%E5%BC%8F"><i class="fas fa-link"></i></a>
</h3>
<p>实际问题中，想判断是否匹配？可以用到<code><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect()</a></code>函数</p>
<div class="sourceCode" id="cb705"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"pear"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"e"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1]  TRUE FALSE  TRUE</code></pre>
<p>数据框中也是一样</p>
<pre><code>## # A tibble: 3 × 1
##   x     
##   &lt;chr&gt; 
## 1 apple 
## 2 banana
## 3 pear</code></pre>
<div class="sourceCode" id="cb708"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>has_e <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"e"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   x      has_e
##   &lt;chr&gt;  &lt;lgl&gt;
## 1 apple  TRUE 
## 2 banana FALSE
## 3 pear   TRUE</code></pre>
<p>用于筛选也很方便</p>
<div class="sourceCode" id="cb710"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"e"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 2 × 1
##   x    
##   &lt;chr&gt;
## 1 apple
## 2 pear</code></pre>
<p><code><a href="https://stringr.tidyverse.org/reference/stringr-data.html">stringr::words</a></code>包含了牛津字典里常用单词</p>
<div class="sourceCode" id="cb712"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">stringr</span><span class="fu">::</span><span class="va"><a href="https://stringr.tidyverse.org/reference/stringr-data.html">words</a></span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "a"        "able"     "about"    "absolute" "accept"   "account"</code></pre>
<p>我们统计下以<code>t</code>开头的单词，有多少个？</p>
<div class="sourceCode" id="cb714"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># How many common words start with t?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">words</span>, <span class="st">"^t"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 65</code></pre>
<p>我们又一次看到了<strong>强制转换</strong>.</p>
<p>以元音结尾的单词，占比多少？</p>
<div class="sourceCode" id="cb716"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># proportion of common words end with a vowel?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">words</span>, <span class="st">"[aeiou]$"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 0.2765306</code></pre>
<p>放在数据框里看看, 看看以<code>x</code>结尾的单词是哪些？</p>
<div class="sourceCode" id="cb718"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  word <span class="op">=</span> <span class="va">words</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">word</span>, <span class="st">"x$"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 4 × 1
##   word 
##   &lt;chr&gt;
## 1 box  
## 2 sex  
## 3 six  
## 4 tax</code></pre>
<p><code><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect()</a></code> 有一个功能类似的函数<code><a href="https://stringr.tidyverse.org/reference/str_count.html">str_count()</a></code>，区别在于，后者不是简单地返回是或否，而是返回字符串中匹配的数量</p>
<div class="sourceCode" id="cb720"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"pear"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_count.html">str_count</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"a"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 1 3 1</code></pre>
<div class="sourceCode" id="cb722"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  word <span class="op">=</span> <span class="va">words</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    vowels <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_count.html">str_count</a></span><span class="op">(</span><span class="va">word</span>, <span class="st">"[aeiou]"</span><span class="op">)</span>,</span>
<span>    consonants <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_count.html">str_count</a></span><span class="op">(</span><span class="va">word</span>, <span class="st">"[^aeiou]"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 980 × 3
##    word     vowels consonants
##    &lt;chr&gt;     &lt;int&gt;      &lt;int&gt;
##  1 a             1          0
##  2 able          2          2
##  3 about         3          2
##  4 absolute      4          4
##  5 accept        2          4
##  6 account       3          4
##  7 achieve       4          3
##  8 across        2          4
##  9 act           1          2
## 10 active        3          3
## # ℹ 970 more rows</code></pre>
</div>
<div id="确定匹配的位置" class="section level3" number="15.5.2">
<h3>
<span class="header-section-number">15.5.2</span> 确定匹配的位置<a class="anchor" aria-label="anchor" href="#%E7%A1%AE%E5%AE%9A%E5%8C%B9%E9%85%8D%E7%9A%84%E4%BD%8D%E7%BD%AE"><i class="fas fa-link"></i></a>
</h3>
<p>大家放心，正则表达式不会重叠匹配。比如用<code>"aba"</code>去匹配<code>"abababa"</code>，肉眼感觉是三次，但正则表达式告诉我们是两次，因为不会重叠匹配</p>
<div class="sourceCode" id="cb724"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_count.html">str_count</a></span><span class="op">(</span><span class="st">"abababa"</span>, <span class="st">"aba"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb726"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view_all</a></span><span class="op">(</span><span class="st">"abababa"</span>, <span class="st">"aba"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Warning: `str_view()` was deprecated in stringr 1.5.0.
## ℹ Please use `str_view_all()` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.</code></pre>
<pre><code>## [1] │ &lt;aba&gt;b&lt;aba&gt;</code></pre>
<p>这里插播一个正则表达式”，它用于匹配单词字符与非单词字符（比如逗号、空格、句点）之间的位置。比如这里返回字符串中<code>s</code>的个数</p>
<div class="sourceCode" id="cb729"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"she sells seashells"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_count.html">str_count</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"s"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 6</code></pre>
<p>这里的<code>s</code>后面必须跟一个非字符的符号，比如逗号、空格、句点等，因此是2个</p>
<div class="sourceCode" id="cb731"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"she sells seashells"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_count.html">str_count</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"s\\b"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 2</code></pre>
</div>
<div id="提取匹配的内容" class="section level3" number="15.5.3">
<h3>
<span class="header-section-number">15.5.3</span> 提取匹配的内容<a class="anchor" aria-label="anchor" href="#%E6%8F%90%E5%8F%96%E5%8C%B9%E9%85%8D%E7%9A%84%E5%86%85%E5%AE%B9"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb733"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colours</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"red"</span>, <span class="st">"orange"</span>, <span class="st">"yellow"</span>,</span>
<span>  <span class="st">"green"</span>, <span class="st">"blue"</span>, <span class="st">"purple"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">colour_match</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="va">colours</span>, collapse <span class="op">=</span> <span class="st">"|"</span><span class="op">)</span></span>
<span><span class="va">colour_match</span></span></code></pre></div>
<pre><code>## [1] "red|orange|yellow|green|blue|purple"</code></pre>
<p>colour_match 这里是一个字符串，放在pattern参数位置上也是正则表达式了,</p>
<p>这里注意以下两者的区别</p>
<div class="sourceCode" id="cb735"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="st">"abcd"</span>, <span class="st">"ab|cd"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="st">"abc"</span>, <span class="st">"a[bc]d"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb736"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">more</span> <span class="op">&lt;-</span> <span class="st">"It is hard to erase blue or red ink."</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">more</span>, pattern <span class="op">=</span> <span class="va">colour_match</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "blue"</code></pre>
<div class="sourceCode" id="cb738"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract_all</a></span><span class="op">(</span><span class="va">more</span>, pattern <span class="op">=</span> <span class="va">colour_match</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [[1]]
## [1] "blue" "red"</code></pre>
<div class="sourceCode" id="cb740"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">more</span> <span class="op">&lt;-</span> <span class="va">sentences</span><span class="op">[</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_count.html">str_count</a></span><span class="op">(</span><span class="va">sentences</span>, <span class="va">colour_match</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">more</span></span></code></pre></div>
<pre><code>## [1] "It is hard to erase blue or red ink."          
## [2] "The green light in the brown box flickered."   
## [3] "The sky in the west is tinged with orange red."</code></pre>
<p>取出sentences中，含有有两种和两种颜色以上的句子。不过，不喜欢这种写法，看着费劲，还是用tidyverse的方法</p>
<div class="sourceCode" id="cb742"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>sentence <span class="op">=</span> <span class="va">sentences</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_count.html">str_count</a></span><span class="op">(</span><span class="va">sentences</span>, <span class="va">colour_match</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 1
##   sentence                                      
##   &lt;chr&gt;                                         
## 1 It is hard to erase blue or red ink.          
## 2 The green light in the brown box flickered.   
## 3 The sky in the west is tinged with orange red.</code></pre>
<p><code><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract()</a></code>提取匹配, 谁先匹配就提取谁</p>
<div class="sourceCode" id="cb744"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">more</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">colour_match</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   x                                              color 
##   &lt;chr&gt;                                          &lt;chr&gt; 
## 1 It is hard to erase blue or red ink.           blue  
## 2 The green light in the brown box flickered.    green 
## 3 The sky in the west is tinged with orange red. orange</code></pre>
<p><code><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract_all()</a></code>提取全部匹配项</p>
<div class="sourceCode" id="cb746"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">more</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract_all</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">colour_match</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   x                                              color    
##   &lt;chr&gt;                                          &lt;list&gt;   
## 1 It is hard to erase blue or red ink.           &lt;chr [2]&gt;
## 2 The green light in the brown box flickered.    &lt;chr [2]&gt;
## 3 The sky in the west is tinged with orange red. &lt;chr [2]&gt;</code></pre>
<div class="sourceCode" id="cb748"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">more</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract_all</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">colour_match</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest</a></span><span class="op">(</span><span class="va">color</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   x                                              color 
##   &lt;chr&gt;                                          &lt;chr&gt; 
## 1 It is hard to erase blue or red ink.           blue  
## 2 It is hard to erase blue or red ink.           red   
## 3 The green light in the brown box flickered.    green 
## 4 The green light in the brown box flickered.    red   
## 5 The sky in the west is tinged with orange red. orange
## 6 The sky in the west is tinged with orange red. red</code></pre>
</div>
<div id="替换匹配内容" class="section level3" number="15.5.4">
<h3>
<span class="header-section-number">15.5.4</span> 替换匹配内容<a class="anchor" aria-label="anchor" href="#%E6%9B%BF%E6%8D%A2%E5%8C%B9%E9%85%8D%E5%86%85%E5%AE%B9"><i class="fas fa-link"></i></a>
</h3>
<p>只替换匹配的第一项</p>
<div class="sourceCode" id="cb750"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"apple"</span>, <span class="st">"pear"</span>, <span class="st">"banana"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"[aeiou]"</span>, <span class="st">"-"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "-pple"  "p-ar"   "b-nana"</code></pre>
<p>替换全部匹配项</p>
<div class="sourceCode" id="cb752"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"[aeiou]"</span>, <span class="st">"-"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "-ppl-"  "p--r"   "b-n-n-"</code></pre>
</div>
<div id="拆分字符串" class="section level3" number="15.5.5">
<h3>
<span class="header-section-number">15.5.5</span> 拆分字符串<a class="anchor" aria-label="anchor" href="#%E6%8B%86%E5%88%86%E5%AD%97%E7%AC%A6%E4%B8%B2"><i class="fas fa-link"></i></a>
</h3>
<p>这个和<code><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c()</a></code>是相反的操作</p>
<div class="sourceCode" id="cb754"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lines</span> <span class="op">&lt;-</span> <span class="st">"I love my country"</span></span>
<span><span class="va">lines</span></span></code></pre></div>
<pre><code>## [1] "I love my country"</code></pre>
<div class="sourceCode" id="cb756"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">" "</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [[1]]
## [1] "I"       "love"    "my"      "country"</code></pre>
<div class="sourceCode" id="cb758"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fields</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Name: Hadley"</span>, <span class="st">"Country: NZ"</span>, <span class="st">"Age: 35"</span><span class="op">)</span></span>
<span><span class="va">fields</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op">(</span><span class="st">": "</span>, n <span class="op">=</span> <span class="fl">2</span>, simplify <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code>##      [,1]      [,2]    
## [1,] "Name"    "Hadley"
## [2,] "Country" "NZ"    
## [3,] "Age"     "35"</code></pre>
</div>
</div>
<div id="进阶部分" class="section level2" number="15.6">
<h2>
<span class="header-section-number">15.6</span> 进阶部分<a class="anchor" aria-label="anchor" href="#%E8%BF%9B%E9%98%B6%E9%83%A8%E5%88%86"><i class="fas fa-link"></i></a>
</h2>
<p>带有条件的匹配</p>
<div id="look-ahead" class="section level3" number="15.6.1">
<h3>
<span class="header-section-number">15.6.1</span> look ahead<a class="anchor" aria-label="anchor" href="#look-ahead"><i class="fas fa-link"></i></a>
</h3>
<p>想匹配Windows，同时希望Windows右侧是<code>"95", "98", "NT", "2000"</code>中的一个</p>
<div class="sourceCode" id="cb760"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">win</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Windows2000"</span>, <span class="st">"Windows"</span>, <span class="st">"Windows3.1"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">win</span>, <span class="st">"Windows(?=95|98|NT|2000)"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] │ &lt;Windows&gt;2000</code></pre>
<div class="sourceCode" id="cb762"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">win</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Windows2000"</span>, <span class="st">"Windows"</span>, <span class="st">"Windows3.1"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">win</span>, <span class="st">"Windows(?!95|98|NT|2000)"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [2] │ &lt;Windows&gt;
## [3] │ &lt;Windows&gt;3.1</code></pre>
<p>Windows后面的 <code>()</code> 是匹配条件，事实上，有四种情形：</p>
<ul>
<li>
<code>(?=pattern)</code> 要求此位置的后面必须匹配表达式pattern</li>
<li>
<code>(?!pattern)</code> 要求此位置的后面不能匹配表达式pattern</li>
<li>
<code>(?&lt;=pattern)</code> 要求此位置的前面必须匹配表达式pattern</li>
<li>
<code>(?&lt;!pattern)</code> 要求此位置的前面不能匹配表达式pattern</li>
</ul>
<div class="danger">
<p>
注意：对于正则表达式引擎来说，它是从文本头部向尾部（从左到右）开始解析的，因此对于文本尾部方向，称为“前”，因为这个时候，正则引擎还没走到那块；而对文本头部方向，则称为“后”，因为正则引擎已经走过了那一块地方。
</p>
</div>
</div>
<div id="look-behind" class="section level3" number="15.6.2">
<h3>
<span class="header-section-number">15.6.2</span> look behind<a class="anchor" aria-label="anchor" href="#look-behind"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb764"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">win</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2000Windows"</span>, <span class="st">"Windows"</span>, <span class="st">"3.1Windows"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">win</span>, <span class="st">"(?&lt;=95|98|NT|2000)Windows"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] │ 2000&lt;Windows&gt;</code></pre>
<div class="sourceCode" id="cb766"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">win</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2000Windows"</span>, <span class="st">"Windows"</span>, <span class="st">"3.1Windows"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">win</span>, <span class="st">"(?&lt;!95|98|NT|2000)Windows"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [2] │ &lt;Windows&gt;
## [3] │ 3.1&lt;Windows&gt;</code></pre>
</div>
</div>
<div id="案例分析" class="section level2" number="15.7">
<h2>
<span class="header-section-number">15.7</span> 案例分析<a class="anchor" aria-label="anchor" href="#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90"><i class="fas fa-link"></i></a>
</h2>
<div id="案例1" class="section level3" number="15.7.1">
<h3>
<span class="header-section-number">15.7.1</span> 案例1<a class="anchor" aria-label="anchor" href="#%E6%A1%88%E4%BE%8B1"><i class="fas fa-link"></i></a>
</h3>
<p>我们希望能提取第二列中的数值，构成新的一列</p>
<div class="sourceCode" id="cb768"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"wk 3"</span>, <span class="st">"week-1"</span>, <span class="st">"7"</span>, <span class="st">"w#9"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">dt</span></span></code></pre></div>
<pre><code>## # A tibble: 4 × 2
##       x y     
##   &lt;int&gt; &lt;chr&gt; 
## 1     1 wk 3  
## 2     2 week-1
## 3     3 7     
## 4     4 w#9</code></pre>
<div class="sourceCode" id="cb770"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dt</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    z <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">y</span>, <span class="st">"[0-9]"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 4 × 3
##       x y      z    
##   &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;
## 1     1 wk 3   3    
## 2     2 week-1 1    
## 3     3 7      7    
## 4     4 w#9    9</code></pre>
</div>
<div id="案例2" class="section level3" number="15.7.2">
<h3>
<span class="header-section-number">15.7.2</span> 案例2<a class="anchor" aria-label="anchor" href="#%E6%A1%88%E4%BE%8B2"><i class="fas fa-link"></i></a>
</h3>
<p>提取第二列中的大写字母</p>
<div class="sourceCode" id="cb772"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2016123456"</span>, <span class="st">"20150513"</span>, <span class="st">"AB2016123456"</span>, <span class="st">"J2017000987"</span>, <span class="st">"B2017000987C"</span>, <span class="st">"aksdf"</span>, <span class="st">"2014"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">df</span></span></code></pre></div>
<pre><code>##   x            y
## 1 1   2016123456
## 2 2     20150513
## 3 3 AB2016123456
## 4 4  J2017000987
## 5 5 B2017000987C
## 6 6        aksdf
## 7 7         2014</code></pre>
<div class="sourceCode" id="cb774"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    item <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract_all</a></span><span class="op">(</span><span class="va">y</span>, <span class="st">"[A-Z]"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest</a></span><span class="op">(</span><span class="va">item</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 5 × 3
##       x y            item 
##   &lt;int&gt; &lt;chr&gt;        &lt;chr&gt;
## 1     3 AB2016123456 A    
## 2     3 AB2016123456 B    
## 3     4 J2017000987  J    
## 4     5 B2017000987C B    
## 5     5 B2017000987C C</code></pre>
</div>
<div id="案例3" class="section level3" number="15.7.3">
<h3>
<span class="header-section-number">15.7.3</span> 案例3<a class="anchor" aria-label="anchor" href="#%E6%A1%88%E4%BE%8B3"><i class="fas fa-link"></i></a>
</h3>
<p>要求：中英文分开</p>
<div class="sourceCode" id="cb776"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tb</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/extract.html">extract</a></span><span class="op">(</span></span>
<span>    <span class="co"># x, c("en", "cn"), "([:alpha:]+)([^:alpha:]+)",</span></span>
<span>    <span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"en"</span>, <span class="st">"cn"</span><span class="op">)</span>, <span class="st">"([a-zA-Z]+)([^a-zA-Z]+)"</span>,</span>
<span>    remove <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   x      en    cn   
##   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;
## 1 I我    I     我   
## 2 love爱 love  爱   
## 3 you你  you   你</code></pre>
</div>
<div id="案例4" class="section level3" number="15.7.4">
<h3>
<span class="header-section-number">15.7.4</span> 案例4<a class="anchor" aria-label="anchor" href="#%E6%A1%88%E4%BE%8B4"><i class="fas fa-link"></i></a>
</h3>
<p>要求：提取起始数字</p>
<div class="sourceCode" id="cb778"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1-12week"</span>, <span class="st">"1-10week"</span>, <span class="st">"5-12week"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 1
##   x       
##   &lt;chr&gt;   
## 1 1-12week
## 2 1-10week
## 3 5-12week</code></pre>
<div class="sourceCode" id="cb780"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/extract.html">extract</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="co"># c("start", "end", "cn"), "([:digit:]+)-([:digit:]+)([^:alpha:]+)",</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"start"</span>, <span class="st">"end"</span>, <span class="st">"cn"</span><span class="op">)</span>, <span class="st">"(\\d+)-(\\d+)(\\D+)"</span>,</span>
<span>  remove <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 4
##   x        start end   cn   
##   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
## 1 1-12week 1     12    week 
## 2 1-10week 1     10    week 
## 3 5-12week 5     12    week</code></pre>
</div>
<div id="案例5" class="section level3" number="15.7.5">
<h3>
<span class="header-section-number">15.7.5</span> 案例5<a class="anchor" aria-label="anchor" href="#%E6%A1%88%E4%BE%8B5"><i class="fas fa-link"></i></a>
</h3>
<p>要求：提取大写字母后的数字</p>
<div class="sourceCode" id="cb782"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"12W34"</span>, <span class="st">"AB2C46"</span>, <span class="st">"B217C"</span>, <span class="st">"akTs6df"</span>, <span class="st">"21WD4"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb783"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>item <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract_all</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"(?&lt;=[A-Z])[0-9]"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest</a></span><span class="op">(</span><span class="va">item</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   x      item 
##   &lt;chr&gt;  &lt;chr&gt;
## 1 12W34  3    
## 2 AB2C46 2    
## 3 AB2C46 4    
## 4 B217C  2    
## 5 21WD4  4</code></pre>
<p>思考题，</p>
<ul>
<li>如何提取大写字母后的连续数字，比如B217C后面的217</li>
<li>如何提取提取数字前的大写字母？</li>
<li>为什么第一个正则表达式返回结果为””</li>
</ul>
<div class="sourceCode" id="cb785"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="st">"Roman numerals: MDCCCLXXXVIII"</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_match.html">str_match_all</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"C?"</span><span class="op">)</span> </span></code></pre></div>
<pre><code>## [[1]]
##       [,1]
##  [1,] ""  
##  [2,] ""  
##  [3,] ""  
##  [4,] ""  
##  [5,] ""  
##  [6,] ""  
##  [7,] ""  
##  [8,] ""  
##  [9,] ""  
## [10,] ""  
## [11,] ""  
## [12,] ""  
## [13,] ""  
## [14,] ""  
## [15,] ""  
## [16,] ""  
## [17,] ""  
## [18,] ""  
## [19,] "C" 
## [20,] "C" 
## [21,] "C" 
## [22,] ""  
## [23,] ""  
## [24,] ""  
## [25,] ""  
## [26,] ""  
## [27,] ""  
## [28,] ""  
## [29,] ""  
## [30,] ""</code></pre>
<div class="sourceCode" id="cb787"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_match.html">str_match_all</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"CC?"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [[1]]
##      [,1]
## [1,] "CC"
## [2,] "C"</code></pre>
<p>“?”的意思是匹配0次或者1次</p>
</div>
<div id="案例6" class="section level3" number="15.7.6">
<h3>
<span class="header-section-number">15.7.6</span> 案例6<a class="anchor" aria-label="anchor" href="#%E6%A1%88%E4%BE%8B6"><i class="fas fa-link"></i></a>
</h3>
<p>提取数字并求和</p>
<div class="sourceCode" id="cb789"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1234"</span>, <span class="st">"B246"</span>, <span class="st">"217C"</span>, <span class="st">"2357f"</span>, <span class="st">"21WD4"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">df</span></span></code></pre></div>
<pre><code>## # A tibble: 5 × 1
##   x    
##   &lt;chr&gt;
## 1 1234 
## 2 B246 
## 3 217C 
## 4 2357f
## 5 21WD4</code></pre>
<div class="sourceCode" id="cb791"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>num <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_match.html">str_match_all</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"\\d"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest</a></span><span class="op">(</span><span class="va">num</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_at</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">num</span><span class="op">)</span>, <span class="va">as.numeric</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>sum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">num</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   x       sum
##   &lt;chr&gt; &lt;dbl&gt;
## 1 1234     10
## 2 217C     10
## 3 21WD4     7
## 4 2357f    17
## 5 B246     12</code></pre>
</div>
<div id="案例7" class="section level3" number="15.7.7">
<h3>
<span class="header-section-number">15.7.7</span> 案例7<a class="anchor" aria-label="anchor" href="#%E6%A1%88%E4%BE%8B7"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb793"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">text</span> <span class="op">&lt;-</span> <span class="st">"Quantum entanglement is a physical phenomenon that occurs when pairs or groups of particles are generated, interact, or share spatial proximity in ways such that the quantum state of each particle cannot be described independently of the state of the others, even when the particles are separated by a large distance."</span></span>
<span></span>
<span></span>
<span><span class="va">pairs</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>    <span class="op">~</span><span class="va">item</span>, <span class="op">~</span><span class="va">code</span>,</span>
<span>    <span class="st">"Quantum entanglement"</span>, <span class="st">"A01"</span>,</span>
<span>    <span class="st">"physical phenomenon"</span>, <span class="st">"A02"</span>,</span>
<span>    <span class="st">"quantum state"</span>, <span class="st">"A03"</span>,</span>
<span>    <span class="st">"quantum mechanics"</span>, <span class="st">"A04"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/enframe.html">deframe</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">text</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span><span class="va">pairs</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "A01 is a A02 that occurs when pairs or groups of particles are generated, interact, or share spatial proximity in ways such that the A03 of each particle cannot be described independently of the state of the others, even when the particles are separated by a large distance."</code></pre>
</div>
</div>
<div id="回答提问" class="section level2" number="15.8">
<h2>
<span class="header-section-number">15.8</span> 回答提问<a class="anchor" aria-label="anchor" href="#%E5%9B%9E%E7%AD%94%E6%8F%90%E9%97%AE"><i class="fas fa-link"></i></a>
</h2>
<p>回到上课前的提问：如何提取<code>Sichuan Univ</code>后面的学院？</p>
<pre><code>## # A tibble: 8 × 2
##      No address                      
##   &lt;int&gt; &lt;chr&gt;                        
## 1     1 Sichuan Univ, Coll Chem      
## 2     2 Sichuan Univ, Coll Elect Engn
## 3     3 Sichuan Univ, Dept Phys      
## 4     4 Sichuan Univ, Coll Life Sci  
## 5     6 Sichuan Univ, Food Engn      
## 6     7 Sichuan Univ, Coll Phys      
## 7     8 Sichuan Univ, Sch Business   
## 8     9 Wuhan Univ, Mat Sci</code></pre>
<div class="sourceCode" id="cb796"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    coll <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">address</span>, <span class="st">"(?&lt;=Sichuan Univ,).*"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest</a></span><span class="op">(</span><span class="va">coll</span>, keep_empty <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 8 × 3
##      No address                       coll              
##   &lt;int&gt; &lt;chr&gt;                         &lt;chr&gt;             
## 1     1 Sichuan Univ, Coll Chem       " Coll Chem"      
## 2     2 Sichuan Univ, Coll Elect Engn " Coll Elect Engn"
## 3     3 Sichuan Univ, Dept Phys       " Dept Phys"      
## 4     4 Sichuan Univ, Coll Life Sci   " Coll Life Sci"  
## 5     6 Sichuan Univ, Food Engn       " Food Engn"      
## 6     7 Sichuan Univ, Coll Phys       " Coll Phys"      
## 7     8 Sichuan Univ, Sch Business    " Sch Business"   
## 8     9 Wuhan Univ, Mat Sci            &lt;NA&gt;</code></pre>
<p>当然还有其他的解决办法</p>
<div class="sourceCode" id="cb798"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>  coll <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">address</span>, <span class="st">".*,"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb799"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span></span>
<span>  <span class="va">address</span>,</span>
<span>  into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"univ"</span>, <span class="st">"coll"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">","</span>, remove <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb800"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/extract.html">extract</a></span><span class="op">(</span></span>
<span>    <span class="va">address</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"univ"</span>, <span class="st">"coll"</span><span class="op">)</span>, <span class="st">"(Sichuan Univ), (.+)"</span>,</span>
<span>    remove <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="tidyverse-tidyr2.html"><span class="header-section-number">14</span> 数据规整2</a></div>
<div class="next"><a href="tidyverse-tibble.html"><span class="header-section-number">16</span> 简单数据框</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#tidyverse-stringr"><span class="header-section-number">15</span> 正则表达式</a></li>
<li><a class="nav-link" href="#%E9%97%AE%E9%A2%98"><span class="header-section-number">15.1</span> 问题</a></li>
<li><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="header-section-number">15.2</span> 什么是正则表达式</a></li>
<li>
<a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%9F%BA%E7%A1%80"><span class="header-section-number">15.3</span> 字符串基础</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%95%BF%E5%BA%A6"><span class="header-section-number">15.3.1</span> 字符串长度</a></li>
<li><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%BB%84%E5%90%88"><span class="header-section-number">15.3.2</span> 字符串组合</a></li>
<li><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8F%96%E5%AD%90%E9%9B%86"><span class="header-section-number">15.3.3</span> 字符串取子集</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%BF%9B%E8%A1%8C%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D"><span class="header-section-number">15.4</span> 使用正则表达式进行模式匹配</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E5%8C%B9%E9%85%8D"><span class="header-section-number">15.4.1</span> 基础匹配</a></li>
<li><a class="nav-link" href="#%E9%94%9A%E7%82%B9"><span class="header-section-number">15.4.2</span> 锚点</a></li>
<li><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E7%B1%BB%E4%B8%8E%E5%AD%97%E7%AC%A6%E9%80%89%E9%A1%B9"><span class="header-section-number">15.4.3</span> 字符类与字符选项</a></li>
<li><a class="nav-link" href="#%E9%87%8D%E5%A4%8D"><span class="header-section-number">15.4.4</span> 重复</a></li>
<li><a class="nav-link" href="#%E5%88%86%E7%BB%84%E4%B8%8E%E5%9B%9E%E6%BA%AF%E5%BC%95%E7%94%A8"><span class="header-section-number">15.4.5</span> 分组与回溯引用</a></li>
<li><a class="nav-link" href="#%E5%A4%A7%E5%B0%8F%E5%86%99%E6%95%8F%E6%84%9F"><span class="header-section-number">15.4.6</span> 大小写敏感</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E5%AE%9E%E9%99%85%E9%97%AE%E9%A2%98"><span class="header-section-number">15.5</span> 解决实际问题</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E7%A1%AE%E5%AE%9A%E4%B8%80%E4%B8%AA%E5%AD%97%E7%AC%A6%E5%90%91%E9%87%8F%E6%98%AF%E5%90%A6%E5%8C%B9%E9%85%8D%E4%B8%80%E7%A7%8D%E6%A8%A1%E5%BC%8F"><span class="header-section-number">15.5.1</span> 确定一个字符向量是否匹配一种模式</a></li>
<li><a class="nav-link" href="#%E7%A1%AE%E5%AE%9A%E5%8C%B9%E9%85%8D%E7%9A%84%E4%BD%8D%E7%BD%AE"><span class="header-section-number">15.5.2</span> 确定匹配的位置</a></li>
<li><a class="nav-link" href="#%E6%8F%90%E5%8F%96%E5%8C%B9%E9%85%8D%E7%9A%84%E5%86%85%E5%AE%B9"><span class="header-section-number">15.5.3</span> 提取匹配的内容</a></li>
<li><a class="nav-link" href="#%E6%9B%BF%E6%8D%A2%E5%8C%B9%E9%85%8D%E5%86%85%E5%AE%B9"><span class="header-section-number">15.5.4</span> 替换匹配内容</a></li>
<li><a class="nav-link" href="#%E6%8B%86%E5%88%86%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="header-section-number">15.5.5</span> 拆分字符串</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E8%BF%9B%E9%98%B6%E9%83%A8%E5%88%86"><span class="header-section-number">15.6</span> 进阶部分</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#look-ahead"><span class="header-section-number">15.6.1</span> look ahead</a></li>
<li><a class="nav-link" href="#look-behind"><span class="header-section-number">15.6.2</span> look behind</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90"><span class="header-section-number">15.7</span> 案例分析</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E6%A1%88%E4%BE%8B1"><span class="header-section-number">15.7.1</span> 案例1</a></li>
<li><a class="nav-link" href="#%E6%A1%88%E4%BE%8B2"><span class="header-section-number">15.7.2</span> 案例2</a></li>
<li><a class="nav-link" href="#%E6%A1%88%E4%BE%8B3"><span class="header-section-number">15.7.3</span> 案例3</a></li>
<li><a class="nav-link" href="#%E6%A1%88%E4%BE%8B4"><span class="header-section-number">15.7.4</span> 案例4</a></li>
<li><a class="nav-link" href="#%E6%A1%88%E4%BE%8B5"><span class="header-section-number">15.7.5</span> 案例5</a></li>
<li><a class="nav-link" href="#%E6%A1%88%E4%BE%8B6"><span class="header-section-number">15.7.6</span> 案例6</a></li>
<li><a class="nav-link" href="#%E6%A1%88%E4%BE%8B7"><span class="header-section-number">15.7.7</span> 案例7</a></li>
</ul>
</li>
<li><a class="nav-link" href="#%E5%9B%9E%E7%AD%94%E6%8F%90%E9%97%AE"><span class="header-section-number">15.8</span> 回答提问</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R编程与作图</strong>" was written by Suoqin Jin. It was last built on 2023-11-22.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
