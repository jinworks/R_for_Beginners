<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>第 25 章 ggplot2之从图层到几何形状 | R编程与作图</title>
<meta name="author" content="Suoqin Jin">
<meta name="description" content="用ggplot2，大多是从几何形状出发，总有“只见树木不见森林”的感觉。我尝试从图层结构出发，去思考ggplot2绘图原理。欢迎大家批评指正。  25.1 图层的五大元素 ggplot2中每个图层都要有的五大元素： 数据data 美学映射mapping 几何形状geom 统计变换stat 位置调整position...">
<meta name="generator" content="bookdown 0.36 with bs4_book()">
<meta property="og:title" content="第 25 章 ggplot2之从图层到几何形状 | R编程与作图">
<meta property="og:type" content="book">
<meta property="og:description" content="用ggplot2，大多是从几何形状出发，总有“只见树木不见森林”的感觉。我尝试从图层结构出发，去思考ggplot2绘图原理。欢迎大家批评指正。  25.1 图层的五大元素 ggplot2中每个图层都要有的五大元素： 数据data 美学映射mapping 几何形状geom 统计变换stat 位置调整position...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="第 25 章 ggplot2之从图层到几何形状 | R编程与作图">
<meta name="twitter:description" content="用ggplot2，大多是从几何形状出发，总有“只见树木不见森林”的感觉。我尝试从图层结构出发，去思考ggplot2绘图原理。欢迎大家批评指正。  25.1 图层的五大元素 ggplot2中每个图层都要有的五大元素： 数据data 美学映射mapping 几何形状geom 统计变换stat 位置调整position...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.5.1/transition.js"></script><script src="libs/bs3compat-0.5.1/tabs.js"></script><script src="libs/bs3compat-0.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R编程与作图</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">前言</a></li>
<li class="book-part">R编程基础</li>
<li><a class="" href="baseR-intro-ds.html"><span class="header-section-number">1</span> R语言介绍及资料推荐</a></li>
<li><a class="" href="baseR-install.html"><span class="header-section-number">2</span> 安装与环境配置</a></li>
<li><a class="" href="baseR-objects.html"><span class="header-section-number">3</span> 对象</a></li>
<li><a class="" href="baseR-vectors.html"><span class="header-section-number">4</span> 向量</a></li>
<li><a class="" href="baseR-data-structure.html"><span class="header-section-number">5</span> 数据结构</a></li>
<li><a class="" href="baseR-operators.html"><span class="header-section-number">6</span> 运算符及向量运算</a></li>
<li><a class="" href="baseR-functions.html"><span class="header-section-number">7</span> 函数</a></li>
<li><a class="" href="baseR-functions-adv.html"><span class="header-section-number">8</span> 函数应用</a></li>
<li><a class="" href="baseR-subsetting.html"><span class="header-section-number">9</span> 子集选取</a></li>
<li class="book-part">数据读入与处理</li>
<li><a class="" href="tidyverse-readr.html"><span class="header-section-number">10</span> 读取数据</a></li>
<li><a class="" href="tidyverse-dplyr.html"><span class="header-section-number">11</span> 数据处理</a></li>
<li><a class="" href="tidyverse-dplyr-apply.html"><span class="header-section-number">12</span> dplyr进阶</a></li>
<li><a class="" href="tidyverse-tidyr.html"><span class="header-section-number">13</span> 数据规整1</a></li>
<li><a class="" href="tidyverse-tidyr2.html"><span class="header-section-number">14</span> 数据规整2</a></li>
<li><a class="" href="tidyverse-stringr.html"><span class="header-section-number">15</span> 正则表达式</a></li>
<li><a class="" href="tidyverse-tibble.html"><span class="header-section-number">16</span> 简单数据框</a></li>
<li><a class="" href="tidyverse-workflow.html"><span class="header-section-number">17</span> 回望tidyverse之旅</a></li>
<li class="book-part">画图</li>
<li><a class="" href="tidyverse-ggplot2-aes.html"><span class="header-section-number">18</span> 数据可视化</a></li>
<li><a class="" href="tidyverse-ggplot2-geom.html"><span class="header-section-number">19</span> ggplot2之几何形状</a></li>
<li><a class="" href="tidyverse-ggplot2-scales.html"><span class="header-section-number">20</span> ggplot2之标度</a></li>
<li><a class="" href="tidyverse-ggplot2-theme.html"><span class="header-section-number">21</span> ggplot2之主题设置</a></li>
<li><a class="" href="tidyverse-ggplot2-guides.html"><span class="header-section-number">22</span> ggplot2之图例系统</a></li>
<li><a class="" href="tidyverse-ggplot2-customize.html"><span class="header-section-number">23</span> ggplot2之扩展内容</a></li>
<li><a class="" href="tidyverse-ggplot2-stat-layer.html"><span class="header-section-number">24</span> ggplot2之统计图层</a></li>
<li><a class="active" href="tidyverse-ggplot2-from-layer-to-geom.html"><span class="header-section-number">25</span> ggplot2之从图层到几何形状</a></li>
<li><a class="" href="tidyverse-ggplot2-colors.html"><span class="header-section-number">26</span> ggplot2之数据可视化中的配色</a></li>
<li><a class="" href="tidyverse-ggplot2-override-aes.html"><span class="header-section-number">27</span> ggplot2之控制图例的外观</a></li>
<li><a class="" href="tidyverse-ggplot2-aes-eval.html"><span class="header-section-number">28</span> ggplot2之延迟映射</a></li>
<li><a class="" href="tidyverse-ggplot2-academic.html"><span class="header-section-number">29</span> ggplot2之科研数据可视化</a></li>
<li><a class="" href="tidyverse-ggplot2-gganimate.html"><span class="header-section-number">30</span> ggplot2之让你的数据动起来</a></li>
<li><a class="" href="tidyverse-ggplot2-pass-function-as-parameters.html"><span class="header-section-number">31</span> ggplot2中传递函数作为参数值</a></li>
<li class="book-part">可重复性文档Rmarkdown以及练习</li>
<li><a class="" href="tidyverse-rmarkdown.html"><span class="header-section-number">32</span> 可重复性文档</a></li>
<li><a class="" href="eda-practice.html"><span class="header-section-number">33</span> 一天一练</a></li>
<li class="book-part">GO/KEGG富集分析</li>
<li><a class="" href="GO-KEGG.html"><span class="header-section-number">34</span> GO/KEGG功能富集分析</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="tidyverse-ggplot2-from-layer-to-geom" class="section level1" number="25">
<h1>
<span class="header-section-number">第 25 章</span> ggplot2之从图层到几何形状<a class="anchor" aria-label="anchor" href="#tidyverse-ggplot2-from-layer-to-geom"><i class="fas fa-link"></i></a>
</h1>
<p>用ggplot2，大多是从几何形状出发，总有“只见树木不见森林”的感觉。我尝试从图层结构出发，去思考ggplot2绘图原理。欢迎大家批评指正。</p>
<div id="图层的五大元素" class="section level2" number="25.1">
<h2>
<span class="header-section-number">25.1</span> 图层的五大元素<a class="anchor" aria-label="anchor" href="#%E5%9B%BE%E5%B1%82%E7%9A%84%E4%BA%94%E5%A4%A7%E5%85%83%E7%B4%A0"><i class="fas fa-link"></i></a>
</h2>
<p>ggplot2中每个<strong>图层</strong>都要有的五大元素：</p>
<ol style="list-style-type: decimal">
<li>数据data</li>
<li>美学映射mapping<br>
</li>
<li>几何形状geom</li>
<li>统计变换stat</li>
<li>位置调整position</li>
</ol>
<p>数据映射后，需要指定一种数据统计变换的方式，统计计算数据（不进行统计变换可以理解为是等值变换），最后通过某种几何形状geom来对其进行可视化的展现。</p>
<p>我们现在按照<code>layer() -&gt; stat_*() -&gt; geom_*()</code>这个思路来，理解各种图形。</p>
<p>一般情况下，统计变换会生成新的数据列，在ggplot2里称之为<code>Computed variables</code>，如果想要这些新变量映射到图形属性，就需要使用 <code><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat()</a></code>或者<code><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">stage()</a></code>函数，具体见下面的案例。</p>
</div>
<div id="加载宏包" class="section level2" number="25.2">
<h2>
<span class="header-section-number">25.2</span> 加载宏包<a class="anchor" aria-label="anchor" href="#%E5%8A%A0%E8%BD%BD%E5%AE%8F%E5%8C%85"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb1918"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a></span><span class="op">)</span></span>
<span><span class="va">penguins</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="stat_identity" class="section level2" number="25.3">
<h2>
<span class="header-section-number">25.3</span> stat_identity()<a class="anchor" aria-label="anchor" href="#stat_identity"><i class="fas fa-link"></i></a>
</h2>
<p>就是什么也不干，即等值变换。</p>
<div class="sourceCode" id="cb1919"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"identity"</span>, </span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span>, </span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>na.rm <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-2-1.png" width="672"></div>
<div class="sourceCode" id="cb1920"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_identity.html">stat_identity</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-3-1.png" width="672"></div>
<div class="sourceCode" id="cb1921"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-4-1.png" width="672"></div>
</div>
<div id="stat_count" class="section level2" number="25.4">
<h2>
<span class="header-section-number">25.4</span> stat_count()<a class="anchor" aria-label="anchor" href="#stat_count"><i class="fas fa-link"></i></a>
</h2>
<p>统计 落在x(离散)位置上，点的个数</p>
<p><code>Computed variables</code></p>
<ul>
<li>count: number of points in bin</li>
<li>prop: groupwise proportion</li>
</ul>
<p><code>默认几何形状</code></p>
<ul>
<li>geom_bar()</li>
</ul>
<p><code>适用几何形状</code></p>
<ul>
<li>geom_point() / geom_bar()</li>
</ul>
<div class="sourceCode" id="cb1922"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"count"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"bar"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-5-1.png" width="672"></div>
<div class="sourceCode" id="cb1923"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"count"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-6-1.png" width="672"></div>
<p>这里<code>aes(y = after_stat(count))</code> 可以看作是<code>aes(y = stage(start = NULL, after_stat = count))</code>的简写</p>
<div class="sourceCode" id="cb1924"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"count"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"bar"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">stage</a></span><span class="op">(</span>start <span class="op">=</span> <span class="cn">NULL</span>, after_stat <span class="op">=</span> <span class="va">count</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-7-1.png" width="672"></div>
<div class="sourceCode" id="cb1925"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">stat_count</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"bar"</span>       </span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-8-1.png" width="672"></div>
<div class="sourceCode" id="cb1926"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"count"</span>     </span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-9-1.png" width="672"></div>
<div class="sourceCode" id="cb1927"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">stat_count</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-10-1.png" width="672"></div>
<div class="sourceCode" id="cb1928"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"count"</span>     </span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-11-1.png" width="672"></div>
</div>
<div id="stat_bin" class="section level2" number="25.5">
<h2>
<span class="header-section-number">25.5</span> stat_bin()<a class="anchor" aria-label="anchor" href="#stat_bin"><i class="fas fa-link"></i></a>
</h2>
<p>统计 落在x(连续)区间上，点的个数</p>
<p><code>Computed variables</code></p>
<ul>
<li>count: number of points in bin</li>
<li>density: density of points in bin, scaled to integrate to 1</li>
<li>ncount: count, scaled to maximum of 1</li>
<li>ndensity: density, scaled to maximum of 1</li>
</ul>
<p><code>默认几何形状</code></p>
<ul>
<li>geom_bar()</li>
</ul>
<p><code>适用几何形状</code></p>
<ul>
<li>geom_bar() / geom_histogram() / geom_freqpoly</li>
</ul>
<div class="sourceCode" id="cb1929"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"bin"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"bar"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-12-1.png" width="672"></div>
<div class="sourceCode" id="cb1931"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"bin"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">stage</a></span><span class="op">(</span>start <span class="op">=</span> <span class="va">bill_length_mm</span>, after_stat <span class="op">=</span> <span class="va">x</span><span class="op">)</span>, </span>
<span>                  y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span></span>
<span>                 <span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-13-1.png" width="672"></div>
<div class="sourceCode" id="cb1933"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">stat_bin</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-14-1.png" width="672"></div>
<div class="sourceCode" id="cb1935"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"bin"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-15-1.png" width="672"></div>
<p>geom_histogram 本质实际上是 geom_bar，都依赖stat_bin</p>
<div class="sourceCode" id="cb1937"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"bin"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"bar"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span>, </span>
<span>    position <span class="op">=</span> <span class="st">'identity'</span></span>
<span>  <span class="op">)</span> </span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-16-1.png" width="672"></div>
<div class="sourceCode" id="cb1939"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"bin"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"bar"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">ncount</span><span class="op">)</span><span class="op">)</span>, </span>
<span>    position <span class="op">=</span> <span class="st">'identity'</span></span>
<span>  <span class="op">)</span> </span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-16-2.png" width="672"></div>
<div class="sourceCode" id="cb1941"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">stat_bin</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"bar"</span>,</span>
<span>    position <span class="op">=</span> <span class="st">'identity'</span></span>
<span>  <span class="op">)</span> </span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-17-1.png" width="672"></div>
<div class="sourceCode" id="cb1943"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"bin"</span>,</span>
<span>    position <span class="op">=</span> <span class="st">'identity'</span></span>
<span>  <span class="op">)</span> </span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-18-1.png" width="672"></div>
<p>复杂点的geom_histogram()</p>
<div class="sourceCode" id="cb1945"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, fill <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"bar"</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"bin"</span>,</span>
<span>    position <span class="op">=</span> <span class="st">'dodge'</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-19-1.png" width="672"></div>
<div class="sourceCode" id="cb1947"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, fill <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">stage</a></span><span class="op">(</span><span class="cn">NULL</span>, after_stat <span class="op">=</span> <span class="va">density</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"bar"</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"bin"</span>,</span>
<span>    position <span class="op">=</span> <span class="st">'dodge'</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-20-1.png" width="672"></div>
<div class="sourceCode" id="cb1949"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, fill <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">stat_bin</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"bar"</span>,</span>
<span>    position <span class="op">=</span> <span class="st">'dodge'</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-21-1.png" width="672"></div>
<div class="sourceCode" id="cb1951"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, fill <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">'dodge'</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-22-1.png" width="672"></div>
</div>
<div id="stat_density" class="section level2" number="25.6">
<h2>
<span class="header-section-number">25.6</span> stat_density()<a class="anchor" aria-label="anchor" href="#stat_density"><i class="fas fa-link"></i></a>
</h2>
<p>x(连续)核密度估计，可以看作是直方图的平滑版本</p>
<div class="sourceCode" id="cb1953"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kernel</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"gaussian"</span>, <span class="st">"epanechnikov"</span>, <span class="st">"rectangular"</span>,</span>
<span>           <span class="st">"triangular"</span>, <span class="st">"biweight"</span>,   <span class="st">"cosine"</span>, </span>
<span>           <span class="st">"optcosine"</span><span class="op">)</span></span></code></pre></div>
<p><code>Computed variables</code></p>
<ul>
<li>density: density estimate</li>
<li>count: density * number of points - useful for stacked density plots</li>
<li>scaled: density estimate, scaled to maximum of 1</li>
<li>ndensity: alias for scaled, to mirror the syntax of stat_bin()</li>
</ul>
<p><code>默认几何形状</code></p>
<ul>
<li>geom_area()</li>
</ul>
<p><code>适用几何形状</code></p>
<ul>
<li>geom_area()/ geom_line()/ geom_point()/ geom_density()</li>
</ul>
<div class="sourceCode" id="cb1954"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>        stat <span class="op">=</span> <span class="st">"density"</span>,</span>
<span>        geom <span class="op">=</span> <span class="st">"area"</span>,</span>
<span>      params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>kernel <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-24-1.png" width="672"></div>
<div class="sourceCode" id="cb1955"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>        stat <span class="op">=</span> <span class="st">"density"</span>,</span>
<span>        geom <span class="op">=</span> <span class="st">"line"</span>,</span>
<span>      params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>kernel <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-25-1.png" width="672"></div>
<div class="sourceCode" id="cb1956"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>        stat <span class="op">=</span> <span class="st">"density"</span>,</span>
<span>        geom <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>      params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>kernel <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-26-1.png" width="672"></div>
<div class="sourceCode" id="cb1957"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">stat_density</a></span><span class="op">(</span></span>
<span>        geom <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>      kernel <span class="op">=</span> <span class="st">"gaussian"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-27-1.png" width="672"></div>
</div>
<div id="stat_boxplot" class="section level2" number="25.7">
<h2>
<span class="header-section-number">25.7</span> stat_boxplot()<a class="anchor" aria-label="anchor" href="#stat_boxplot"><i class="fas fa-link"></i></a>
</h2>
<p>计算连续变量的五个统计值 (the median, two hinges and two whiskers), 以及outlier</p>
<ul>
<li>
<p><code>Aesthetics</code></p>
<ul>
<li>x or y; lower; upper; middle; ymin ; ymax</li>
</ul>
</li>
<li>
<p><code>Computed variables</code></p>
<ul>
<li>
<code>width</code>: width of boxplot</li>
<li>
<code>ymin</code>: lower whisker = smallest observation greater than or equal to lower hinge - 1.5 * IQR</li>
<li>
<code>lower</code>: lower hinge, 25% quantile</li>
<li>
<code>notchlower</code>: lower edge of notch = median - 1.58 * IQR / sqrt(n)</li>
<li>
<code>middle</code>: median, 50% quantile</li>
<li>
<code>notchupper</code>: upper edge of notch = median + 1.58 * IQR / sqrt(n)</li>
<li>
<code>upper</code>: upper hinge, 75% quantile</li>
<li>
<code>ymax</code>: upper whisker = largest observation less than or equal to upper hinge + 1.5 * IQR</li>
</ul>
</li>
</ul>
<p><code>默认几何形状</code></p>
<ul>
<li>geom_boxplot()</li>
</ul>
<p><code>适用几何形状</code></p>
<ul>
<li>geom_boxplot() / geom_point()</li>
</ul>
<div class="sourceCode" id="cb1958"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"boxplot"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"boxplot"</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-28-1.png" width="672"></div>
<div class="sourceCode" id="cb1959"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">stat_boxplot</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"boxplot"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-29-1.png" width="672"></div>
<div class="sourceCode" id="cb1960"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-30-1.png" width="672"></div>
<p>可以根据 <code>Computed variables</code> 画出更多的几何形状</p>
<div class="sourceCode" id="cb1961"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"boxplot"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"boxplot"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">middle</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-31-1.png" width="672"></div>
<div class="sourceCode" id="cb1962"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"boxplot"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">width</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-32-1.png" width="672"></div>
<div class="sourceCode" id="cb1963"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"boxplot"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">stage</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, after_stat <span class="op">=</span> <span class="va">notchupper</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-33-1.png" width="672"></div>
<div class="sourceCode" id="cb1964"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"boxplot"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">stage</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, after_stat <span class="op">=</span> <span class="va">ymax</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span> </span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-34-1.png" width="672"></div>
<div class="sourceCode" id="cb1965"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">stat_boxplot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-35-1.png" width="672"></div>
<div class="sourceCode" id="cb1966"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"boxplot"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">stage</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, after_stat <span class="op">=</span> <span class="va">middle</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span> </span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-36-1.png" width="672"></div>
<div class="sourceCode" id="cb1967"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">species</span>, </span>
<span>        fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_scale</a></span><span class="op">(</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html">alpha</a></span><span class="op">(</span><span class="va">colour</span>, <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-37-1.png" width="672"></div>
</div>
<div id="stat_ydensity" class="section level2" number="25.8">
<h2>
<span class="header-section-number">25.8</span> stat_ydensity()<a class="anchor" aria-label="anchor" href="#stat_ydensity"><i class="fas fa-link"></i></a>
</h2>
<p>可以看作是箱线图的密度图呈现</p>
<p><code>Computed variables</code></p>
<ul>
<li>density: density estimate</li>
<li>scaled: density estimate, scaled to maximum of 1</li>
<li>count: density * number of points - probably useless for violin plots</li>
<li>violinwidth: density scaled for the violin plot, according to area, counts or to a constant maximum width</li>
<li>n: number of points</li>
<li>width: width of violin bounding box</li>
</ul>
<p><code>默认几何形状</code></p>
<ul>
<li>geom_violin()</li>
</ul>
<p><code>适用几何形状</code></p>
<ul>
<li>geom_violin() / geom_point()</li>
</ul>
<div class="sourceCode" id="cb1968"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    geom     <span class="op">=</span> <span class="st">"violin"</span>,</span>
<span>    stat     <span class="op">=</span> <span class="st">"ydensity"</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-38-1.png" width="672"></div>
<div class="sourceCode" id="cb1969"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    geom     <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>    stat     <span class="op">=</span> <span class="st">"ydensity"</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-39-1.png" width="672"></div>
</div>
<div id="stat_bindot" class="section level2" number="25.9">
<h2>
<span class="header-section-number">25.9</span> stat_bindot()<a class="anchor" aria-label="anchor" href="#stat_bindot"><i class="fas fa-link"></i></a>
</h2>
<p>圆点图，是直方图的另外一种形式</p>
<p><code>Computed variables</code></p>
<ul>
<li>x: center of each bin, if binaxis is “x”</li>
<li>y: center of each bin, if binaxis is “x”</li>
<li>binwidth: max width of each bin if method is “dotdensity”;width of each bin if method is “histodot”</li>
<li>count: number of points in bin</li>
<li>ncount: count, scaled to maximum of 1</li>
<li>density: density of points in bin, scaled to integrate to 1, if method is “histodot”</li>
<li>ndensity: density, scaled to maximum of 1, if method is “histodot”</li>
</ul>
<p><code>默认几何形状</code></p>
<ul>
<li>geom_dotplot()</li>
</ul>
<p><code>适用几何形状</code></p>
<ul>
<li>geom_dotplot()</li>
</ul>
<div class="sourceCode" id="cb1970"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"bindot"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"dotplot"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">stage</a></span><span class="op">(</span>start <span class="op">=</span> <span class="cn">NULL</span>, after_stat <span class="op">=</span> <span class="va">count</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span>, dotsize <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, </span>
<span>    position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_nudge.html">position_nudge</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.025</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-40-1.png" width="672"></div>
<div class="sourceCode" id="cb1971"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"bindot"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">stage</a></span><span class="op">(</span>start <span class="op">=</span> <span class="cn">NULL</span>, after_stat <span class="op">=</span> <span class="va">count</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, </span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-41-1.png" width="672"></div>
<div class="sourceCode" id="cb1972"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_dotplot.html">geom_dotplot</a></span><span class="op">(</span></span>
<span>    binwidth <span class="op">=</span> <span class="fl">1</span>, </span>
<span>    dotsize <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-42-1.png" width="672"></div>
<div class="sourceCode" id="cb1973"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_dotplot.html">geom_dotplot</a></span><span class="op">(</span></span>
<span>    binaxis <span class="op">=</span> <span class="st">"y"</span>, </span>
<span>    stackdir <span class="op">=</span> <span class="st">"down"</span>, </span>
<span>    dotsize <span class="op">=</span> <span class="fl">0.4</span>, </span>
<span>    position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_nudge.html">position_nudge</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.025</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<pre><code>## Bin width defaults to 1/30 of the range of the data. Pick better value with
## `binwidth`.</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-43-1.png" width="672"></div>
</div>
<div id="stat_sum" class="section level2" number="25.10">
<h2>
<span class="header-section-number">25.10</span> stat_sum()<a class="anchor" aria-label="anchor" href="#stat_sum"><i class="fas fa-link"></i></a>
</h2>
<p>统计落在x(离散或者连续), y(离散或者连续)位置上，点的个数</p>
<p><code>Computed variables</code></p>
<ul>
<li>n : number of observations at position</li>
<li>prop : percent of points in that panel at that position</li>
</ul>
<p><code>默认几何形状</code></p>
<ul>
<li>geom_point()</li>
</ul>
<p><code>适用几何形状</code></p>
<ul>
<li>geom_point() / geom_count() / geom_bar()</li>
</ul>
<div class="sourceCode" id="cb1975"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"sum"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-44-1.png" width="672"></div>
<div class="sourceCode" id="cb1976"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_count.html">stat_sum</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-45-1.png" width="672"></div>
</div>
<div id="stat_smooth" class="section level2" number="25.11">
<h2>
<span class="header-section-number">25.11</span> stat_smooth()<a class="anchor" aria-label="anchor" href="#stat_smooth"><i class="fas fa-link"></i></a>
</h2>
<p>根据x,y数据和拟合公式，计算每个点位置的拟合值以及标准误</p>
<p><code>Computed variables</code></p>
<ul>
<li>y: predicted value</li>
<li>ymin: lower pointwise confidence interval around the mean</li>
<li>ymax: upper pointwise confidence interval around the mean</li>
<li>se: standard error</li>
</ul>
<p><code>默认几何形状</code></p>
<ul>
<li>geom_smooth()</li>
</ul>
<p><code>适用几何形状</code></p>
<ul>
<li>geom_smooth() / geom_line() / geom_point()</li>
</ul>
<div class="sourceCode" id="cb1977"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"smooth"</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"smooth"</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>se <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code>## `geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-46-1.png" width="672"></div>
<div class="sourceCode" id="cb1979"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">stat_smooth</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"smooth"</span>,</span>
<span>    se <span class="op">=</span> <span class="cn">TRUE</span> </span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code>## `geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-47-1.png" width="672"></div>
<div class="sourceCode" id="cb1981"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span></span>
<span>    se <span class="op">=</span> <span class="cn">TRUE</span> </span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code>## `geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-48-1.png" width="672"></div>
<p>统计转换后，可以根据 <code>Computed variables</code> 画出更多的几何形状</p>
<div class="sourceCode" id="cb1983"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"smooth"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">ymax</span><span class="op">)</span>, color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">ymin</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code>## `geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-49-1.png" width="672"></div>
<div class="sourceCode" id="cb1985"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"smooth"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">ymin</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code>## `geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-50-1.png" width="672"></div>
<div class="sourceCode" id="cb1987"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"smooth"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">stage</a></span><span class="op">(</span><span class="cn">NULL</span>, after_stat <span class="op">=</span> <span class="va">ymin</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code>## `geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-51-1.png" width="672"></div>
<div class="sourceCode" id="cb1989"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"line"</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"smooth"</span>, </span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">ymin</span><span class="op">)</span><span class="op">)</span>,    </span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code>## `geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-52-1.png" width="672"></div>
<div class="sourceCode" id="cb1991"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"pointrange"</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"smooth"</span>, </span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">)</span>,    </span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code>## `geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-53-1.png" width="672"></div>
<div class="sourceCode" id="cb1993"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>        stat <span class="op">=</span> <span class="st">"smooth"</span>,</span>
<span>     mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>,    </span>
<span>        geom <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>      params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>method  <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fu">splines</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/splines/ns.html">ns</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,    </span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-54-1.png" width="672"></div>
</div>
<div id="stat_bin_2d" class="section level2" number="25.12">
<h2>
<span class="header-section-number">25.12</span> stat_bin_2d()<a class="anchor" aria-label="anchor" href="#stat_bin_2d"><i class="fas fa-link"></i></a>
</h2>
<p>统计 落在x和y(长方形)区域上，点的个数</p>
<p><code>Computed variables</code></p>
<ul>
<li>count: number of points in bin</li>
<li>density: density of points in bin, scaled to integrate to 1</li>
<li>ncount: count, scaled to maximum of 1</li>
<li>ndensity: density, scaled to maximum of 1</li>
</ul>
<p><code>默认几何形状</code></p>
<ul>
<li>geom_tile()</li>
</ul>
<p><code>适用几何形状</code></p>
<ul>
<li>geom_tile() / geom_point()/ geom_bin2d()</li>
</ul>
<div class="sourceCode" id="cb1994"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"tile"</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"bin_2d"</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-55-1.png" width="672"></div>
<div class="sourceCode" id="cb1995"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"bin_2d"</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-56-1.png" width="672"></div>
<div class="sourceCode" id="cb1996"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bin_2d.html">stat_bin_2d</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-57-1.png" width="672"></div>
<div class="sourceCode" id="cb1997"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"bin_2d"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-58-1.png" width="672"></div>
<p>可以根据 <code>Computed variables</code> 画出更多的几何形状</p>
<div class="sourceCode" id="cb1998"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"bin_2d"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-59-1.png" width="672"></div>
<div class="sourceCode" id="cb1999"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"tile"</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"bin_2d"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-60-1.png" width="672"></div>
</div>
<div id="stat_bin_hex" class="section level2" number="25.13">
<h2>
<span class="header-section-number">25.13</span> stat_bin_hex()<a class="anchor" aria-label="anchor" href="#stat_bin_hex"><i class="fas fa-link"></i></a>
</h2>
<p>stat_bin2d()的六边形版本</p>
<p><code>Computed variables</code></p>
<ul>
<li>count: number of points in bin</li>
<li>density: density of points in bin, scaled to integrate to 1</li>
<li>ncount: count, scaled to maximum of 1</li>
<li>ndensity: density, scaled to maximum of 1</li>
</ul>
<p><code>默认几何形状</code></p>
<ul>
<li>geom_hex()</li>
</ul>
<p><code>适用几何形状</code></p>
<ul>
<li>geom_hex()</li>
</ul>
<div class="sourceCode" id="cb2000"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"hex"</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"binhex"</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-61-1.png" width="672"></div>
<div class="sourceCode" id="cb2001"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_hex.html">stat_bin_hex</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"hex"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-62-1.png" width="672"></div>
<div class="sourceCode" id="cb2002"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_hex.html">geom_hex</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"binhex"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-63-1.png" width="672"></div>
<p>可以根据 <code>Computed variables</code> 画出更多的几何形状</p>
<div class="sourceCode" id="cb2003"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"text"</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"binhex"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">stage</a></span><span class="op">(</span><span class="cn">NULL</span>, after_stat <span class="op">=</span> <span class="va">count</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-64-1.png" width="672"></div>
</div>
<div id="stat_density_2d" class="section level2" number="25.14">
<h2>
<span class="header-section-number">25.14</span> stat_density_2d()<a class="anchor" aria-label="anchor" href="#stat_density_2d"><i class="fas fa-link"></i></a>
</h2>
<p>二维核密度估计，二维版本的stat_density()</p>
<ul>
<li>不计算等高线 (<code>contour = FALSE</code>)
<ul>
<li>count: number of points in bin<br>
</li>
<li>density: density of points in bin, scaled to integrate to 1<br>
</li>
<li>ncount: count, scaled to maximum of 1<br>
</li>
<li>ndensity: density, scaled to maximum of 1</li>
</ul>
</li>
<li>计算等高线 (<code>contour = TRUE</code>)
<ul>
<li>contour lines, for <code><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html">stat_contour()</a></code> 等高线</li>
<li>contour bands, for <code><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html">stat_contour_filled()</a></code> 等高带</li>
<li>Contours line types by contour_var = (<code>density</code>, <code>ndensity</code>, and <code>count</code>)</li>
</ul>
</li>
</ul>
<p><code>适用几何形状</code></p>
<ul>
<li>geom_density_2d() / geom_raster() / goem_tile() / geom_path() / geom_point() / geom_polygon()</li>
</ul>
<div id="先看看有等高线的情形" class="section level3" number="25.14.1">
<h3>
<span class="header-section-number">25.14.1</span> 先看看有等高线的情形<a class="anchor" aria-label="anchor" href="#%E5%85%88%E7%9C%8B%E7%9C%8B%E6%9C%89%E7%AD%89%E9%AB%98%E7%BA%BF%E7%9A%84%E6%83%85%E5%BD%A2"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb2004"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span>  <span class="st">"density_2d"</span>,</span>
<span>    geom <span class="op">=</span>  <span class="st">"path"</span>, </span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>contour <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-65-1.png" width="672"></div>
<div class="sourceCode" id="cb2005"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">stat_density_2d</a></span><span class="op">(</span></span>
<span>    contour <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-66-1.png" width="672"></div>
<div class="sourceCode" id="cb2006"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">geom_density_2d</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-67-1.png" width="672"></div>
<div class="sourceCode" id="cb2007"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"density_2d"</span>,</span>
<span>    contour <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-68-1.png" width="672"></div>
<p>可以根据 <code>Computed variables</code> 画出更多的几何形状</p>
<div class="sourceCode" id="cb2008"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span>  <span class="st">"density_2d"</span>,</span>
<span>    geom <span class="op">=</span>  <span class="st">"point"</span>, </span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>contour <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-69-1.png" width="672"></div>
<div class="sourceCode" id="cb2009"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"density_2d"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"polygon"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">level</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>contour <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-70-1.png" width="672"></div>
</div>
<div id="看看无等高线的情形" class="section level3" number="25.14.2">
<h3>
<span class="header-section-number">25.14.2</span> 看看无等高线的情形<a class="anchor" aria-label="anchor" href="#%E7%9C%8B%E7%9C%8B%E6%97%A0%E7%AD%89%E9%AB%98%E7%BA%BF%E7%9A%84%E6%83%85%E5%BD%A2"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb2010"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"density_2d"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"raster"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>contour <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-71-1.png" width="672"></div>
<div class="sourceCode" id="cb2011"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"density_2d"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"tile"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>contour <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-72-1.png" width="672"></div>
<div class="sourceCode" id="cb2012"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">stat_density_2d</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"tile"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    contour <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-73-1.png" width="672"></div>
<div class="sourceCode" id="cb2013"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"density_2d"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    contour <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-74-1.png" width="672"></div>
<p>可以根据 <code>Computed variables</code> 画出更多的几何形状</p>
<div class="sourceCode" id="cb2014"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"density_2d"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">20</span>, contour <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-75-1.png" width="672"></div>
</div>
</div>
<div id="stat_ellipse" class="section level2" number="25.15">
<h2>
<span class="header-section-number">25.15</span> stat_ellipse()<a class="anchor" aria-label="anchor" href="#stat_ellipse"><i class="fas fa-link"></i></a>
</h2>
<p>假定数据服从多元分布，计算椭圆图形需要的参数</p>
<p><code>Computed variables</code></p>
<ul>
<li>x</li>
<li>y</li>
</ul>
<p><code>默认几何形状</code></p>
<ul>
<li>geom_path()</li>
</ul>
<p><code>适用几何形状</code></p>
<ul>
<li>geom_path() /geom_polygon()</li>
</ul>
<div class="sourceCode" id="cb2015"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"ellipse"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"path"</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"norm"</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-76-1.png" width="672"></div>
<div class="sourceCode" id="cb2016"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html">stat_ellipse</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"path"</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"norm"</span>, </span>
<span>    linetype <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-77-1.png" width="672"></div>
<div class="sourceCode" id="cb2017"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span>, color <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"ellipse"</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"norm"</span>, </span>
<span>    linetype <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-78-1.png" width="672"></div>
<p>可以根据 <code>Computed variables</code> 画出更多的几何形状</p>
<div class="sourceCode" id="cb2018"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"ellipse"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"path"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"norm"</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-79-1.png" width="672"></div>
</div>
<div id="stat_summary" class="section level2" number="25.16">
<h2>
<span class="header-section-number">25.16</span> stat_summary<a class="anchor" aria-label="anchor" href="#stat_summary"><i class="fas fa-link"></i></a>
</h2>
<p>每一个x位置上, summary on y</p>
<p><code>说明</code></p>
<ul>
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary()</a></code> operates on unique x or y;</li>
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary_bin()</a></code> operates on binned x or y.</li>
</ul>
<p><code>Summary functions</code></p>
<ul>
<li><p>fun.data :
Complete summary function. Should take numeric vector as input and return data frame as output</p></li>
<li><p>fun.min :
min summary function (should take numeric vector and return single number)</p></li>
<li><p>fun :
main summary function (should take numeric vector and return single number)</p></li>
<li><p>fun.max :
max summary function (should take numeric vector and return single number)</p></li>
</ul>
<p><code>适用几何形状</code></p>
<ul>
<li>geom_errorbar() / geom_pointrange() /geom_linerange() / geom_crossbar() /geom_point()</li>
</ul>
<div class="sourceCode" id="cb2019"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"summary"</span>, </span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fun.data <span class="op">=</span> <span class="st">"mean_cl_normal"</span><span class="op">)</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"errorbar"</span>, </span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code>## Warning: Computation failed in `stat_summary()`
## Caused by error in `fun.data()`:
## ! The package "Hmisc" is required.</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-80-1.png" width="672"></div>
<div class="sourceCode" id="cb2021"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span></span>
<span>    fun.data <span class="op">=</span> <span class="va">mean_cl_normal</span>, </span>
<span>        geom <span class="op">=</span> <span class="st">"errorbar"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code>## Warning: Computation failed in `stat_summary()`
## Caused by error in `fun.data()`:
## ! The package "Hmisc" is required.</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-81-1.png" width="672"></div>
<div class="sourceCode" id="cb2023"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sex</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat     <span class="op">=</span> <span class="st">"summary"</span>,</span>
<span>    geom     <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>    mapping  <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">ymin</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code>## No summary function supplied, defaulting to `mean_se()`</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-82-1.png" width="672"></div>
<div class="sourceCode" id="cb2025"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    geom     <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>    stat     <span class="op">=</span> <span class="st">"summary"</span>,</span>
<span>    params   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="st">"mean"</span>, color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-83-1.png" width="672"></div>
<div class="sourceCode" id="cb2026"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span>, </span>
<span>    stat <span class="op">=</span> <span class="st">"summary"</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">median</span><span class="op">)</span>, </span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">stage</a></span><span class="op">(</span>start <span class="op">=</span> <span class="va">bill_length_mm</span>, after_stat <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-84-1.png" width="672"></div>
<div class="sourceCode" id="cb2027"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sex</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"pointrange"</span>,   </span>
<span>    stat <span class="op">=</span> <span class="st">"summary"</span>, </span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fun.data <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/mean_se.html">mean_se</a></span><span class="op">(</span><span class="va">.</span>, mult <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-85-1.png" width="672"></div>
<div class="sourceCode" id="cb2028"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span></span>
<span>    geom  <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>    fun   <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span>, </span>
<span>    size  <span class="op">=</span> <span class="fl">5</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-86-1.png" width="672"></div>
<div class="sourceCode" id="cb2029"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span> x <span class="op">=</span> <span class="va">body_mass_g</span>, y <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span></span>
<span>    fun <span class="op">=</span> <span class="va">mean</span>, </span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span>, </span>
<span>    size <span class="op">=</span> <span class="fl">5</span>, </span>
<span>    color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-87-1.png" width="672"></div>
<div class="sourceCode" id="cb2030"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sex</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span>  </span>
<span>    fun.data <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/mean_se.html">mean_se</a></span><span class="op">(</span><span class="va">.</span>, mult <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"pointrange"</span>,    </span>
<span>    size <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-88-1.png" width="672"></div>
<div class="sourceCode" id="cb2031"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sex</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_pointrange</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"summary"</span>, </span>
<span>    fun.data <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/mean_se.html">mean_se</a></span><span class="op">(</span><span class="va">.</span>, mult <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-89-1.png" width="672"></div>
<div class="sourceCode" id="cb2032"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sex</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span></span>
<span>    fun.data <span class="op">=</span> <span class="va">mean_cl_boot</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"pointrange"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code>## Warning: Computation failed in `stat_summary()`
## Caused by error in `fun.data()`:
## ! The package "Hmisc" is required.</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-90-1.png" width="672"></div>
<div class="sourceCode" id="cb2034"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sex</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span></span>
<span>    fun <span class="op">=</span> <span class="va">mean</span>, </span>
<span>    fun.min <span class="op">=</span> <span class="va">min</span>, </span>
<span>    fun.max <span class="op">=</span> <span class="va">max</span>,      </span>
<span>    geom <span class="op">=</span> <span class="st">"pointrange"</span>,  </span>
<span>    color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">5</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-91-1.png" width="672"></div>
<div class="sourceCode" id="cb2035"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sex</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span></span>
<span>    fun.data <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/mean_se.html">mean_se</a></span><span class="op">(</span><span class="va">.</span>, mult <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"pointrange"</span>   </span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-92-1.png" width="672"></div>
<div class="sourceCode" id="cb2036"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span>, group <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span></span>
<span>    fun.data <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/mean_se.html">mean_se</a></span><span class="op">(</span><span class="va">.</span>, mult <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"pointrange"</span>    </span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-93-1.png" width="672"></div>
<div class="sourceCode" id="cb2037"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span>, group <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mean</span>,</span>
<span>               fun.min <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, </span>
<span>               fun.max <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, </span>
<span>               geom <span class="op">=</span> <span class="st">"pointrange"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mean</span>,</span>
<span>               geom <span class="op">=</span> <span class="st">"line"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">sex</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-94-1.png" width="672"></div>
<div id="自定义函数-1" class="section level3" number="25.16.1">
<h3>
<span class="header-section-number">25.16.1</span> 自定义函数<a class="anchor" aria-label="anchor" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb2038"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_count</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"bar"</span>,</span>
<span>    fun.data <span class="op">=</span> <span class="va">my_count</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-95-1.png" width="672"></div>
<div class="sourceCode" id="cb2039"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"summary"</span>,</span>
<span>    fun.data <span class="op">=</span> <span class="va">my_count</span>,</span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-96-1.png" width="672"></div>
<div class="sourceCode" id="cb2040"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"bar"</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"summary"</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fun.data <span class="op">=</span> <span class="va">my_count</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-97-1.png" width="672"></div>
</div>
<div id="添加文本" class="section level3" number="25.16.2">
<h3>
<span class="header-section-number">25.16.2</span> 添加文本<a class="anchor" aria-label="anchor" href="#%E6%B7%BB%E5%8A%A0%E6%96%87%E6%9C%AC"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb2041"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>    fun <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span>, </span>
<span>    size <span class="op">=</span> <span class="fl">5</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"text"</span>,</span>
<span>    fun.data <span class="op">=</span> <span class="st">"mean_se"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span>, </span>
<span>    size <span class="op">=</span> <span class="fl">5</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-98-1.png" width="672"></div>
<div class="sourceCode" id="cb2042"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fl">62</span>,</span>
<span>            label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>            color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">100</span>, <span class="st">"red"</span>, <span class="st">"blue"</span><span class="op">)</span></span>
<span>            <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span></span>
<span>    fun.data <span class="op">=</span> <span class="va">n_fun</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"text"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-99-1.png" width="672"></div>
<div class="sourceCode" id="cb2043"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"pointrange"</span>,</span>
<span>    fun.data <span class="op">=</span> <span class="st">"mean_cl_boot"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code>## Warning: Computation failed in `stat_summary()`
## Caused by error in `fun.data()`:
## ! The package "Hmisc" is required.</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-100-1.png" width="672"></div>
<div class="sourceCode" id="cb2045"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"pointrange"</span>,</span>
<span>    fun.data <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/mean_se.html">mean_se</a></span><span class="op">(</span><span class="va">.</span>, mult <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span>, </span>
<span>    size <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span></span>
<span>    fun <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"text"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">stage</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, after_stat <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, </span>
<span>                  label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"blue"</span>, </span>
<span>    size <span class="op">=</span> <span class="fl">5</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span></span>
<span>    fun <span class="op">=</span> <span class="st">"length"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"text"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">stage</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, after_stat <span class="op">=</span> <span class="fl">62</span><span class="op">)</span>, </span>
<span>                  label <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span>                  <span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>    size <span class="op">=</span> <span class="fl">5</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-101-1.png" width="672"></div>
</div>
<div id="更多-1" class="section level3" number="25.16.3">
<h3>
<span class="header-section-number">25.16.3</span> 更多<a class="anchor" aria-label="anchor" href="#%E6%9B%B4%E5%A4%9A-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb2046"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">calc_median_and_fill</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">threshold</span> <span class="op">=</span> <span class="fl">40</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">y</span> <span class="op">&lt;</span> <span class="va">threshold</span>, <span class="st">"red"</span>, <span class="st">"gray50"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span></span>
<span>    fun.data <span class="op">=</span> <span class="va">calc_median_and_fill</span>, </span>
<span>    geom <span class="op">=</span> <span class="st">"bar"</span> </span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-102-1.png" width="672"></div>
<div class="sourceCode" id="cb2047"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">calc_median_and_color</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">threshold</span> <span class="op">=</span> <span class="fl">40</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">y</span> <span class="op">&lt;</span> <span class="va">threshold</span>, <span class="st">"red"</span>, <span class="st">"gray50"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span></span>
<span>    fun.data <span class="op">=</span> <span class="va">calc_median_and_color</span>, </span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">5</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-103-1.png" width="672"></div>
<div class="sourceCode" id="cb2048"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span></span>
<span>    fun.data <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>      </span>
<span>      <span class="va">scaled_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/mean_se.html">mean_se</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">scaled_size</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-104-1.png" width="672"></div>
<div class="sourceCode" id="cb2049"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_jitter.html">position_jitter</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mean</span>, </span>
<span>               na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>               geom <span class="op">=</span> <span class="st">"point"</span>, </span>
<span>               color <span class="op">=</span> <span class="st">"dodgerblue"</span>, </span>
<span>               size <span class="op">=</span> <span class="fl">4</span>, </span>
<span>               shape <span class="op">=</span> <span class="st">"diamond"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span>fun.data <span class="op">=</span> <span class="va">mean_cl_normal</span>,</span>
<span>               na.rm <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>               geom <span class="op">=</span> <span class="st">"errorbar"</span>,</span>
<span>               width <span class="op">=</span> <span class="fl">.2</span>, </span>
<span>               color <span class="op">=</span> <span class="st">"dodgerblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mean</span>, </span>
<span>               na.rm <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>               geom <span class="op">=</span> <span class="st">"line"</span>, </span>
<span>               color <span class="op">=</span> <span class="st">"dodgerblue"</span>, </span>
<span>               size <span class="op">=</span> <span class="fl">.75</span><span class="op">)</span> </span></code></pre></div>
<pre><code>## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
## ℹ Please use `linewidth` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.</code></pre>
<pre><code>## Warning: Computation failed in `stat_summary()`
## Caused by error in `fun.data()`:
## ! The package "Hmisc" is required.</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-105-1.png" width="672"></div>
<div class="sourceCode" id="cb2052"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">bill_depth_mm</span>, group <span class="op">=</span> <span class="va">sex</span>, color <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span></span>
<span>    position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_jitterdodge.html">position_jitterdodge</a></span><span class="op">(</span></span>
<span>      jitter.width <span class="op">=</span> <span class="fl">.2</span>,</span>
<span>      dodge.width <span class="op">=</span> <span class="fl">.7</span></span>
<span>    <span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">.1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span></span>
<span>    fun <span class="op">=</span> <span class="va">mean</span>,</span>
<span>    na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>    shape <span class="op">=</span> <span class="st">"diamond"</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>    position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span></span>
<span>    fun.data <span class="op">=</span> <span class="va">mean_cl_normal</span>,</span>
<span>    na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"errorbar"</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">.2</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>    position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Warning: Computation failed in `stat_summary()`
## Caused by error in `fun.data()`:
## ! The package "Hmisc" is required.</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-106-1.png" width="672"></div>
<div class="sourceCode" id="cb2054"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">bill_depth_mm</span>, group <span class="op">=</span> <span class="va">sex</span>, color <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span></span>
<span>    position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_jitterdodge.html">position_jitterdodge</a></span><span class="op">(</span></span>
<span>      jitter.width <span class="op">=</span> <span class="fl">.2</span>,</span>
<span>      dodge.width <span class="op">=</span> <span class="fl">.7</span></span>
<span>    <span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">.1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span></span>
<span>    fun <span class="op">=</span> <span class="va">mean</span>,</span>
<span>    na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>    shape <span class="op">=</span> <span class="st">"diamond"</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>    position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span></span>
<span>    fun.data <span class="op">=</span> <span class="va">mean_cl_normal</span>,</span>
<span>    na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"errorbar"</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">.2</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>    position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">sex</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Warning: Computation failed in `stat_summary()`
## Computation failed in `stat_summary()`
## Caused by error in `fun.data()`:
## ! The package "Hmisc" is required.</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-107-1.png" width="672"></div>
</div>
</div>
<div id="stat_summary_bin" class="section level2" number="25.17">
<h2>
<span class="header-section-number">25.17</span> stat_summary_bin<a class="anchor" aria-label="anchor" href="#stat_summary_bin"><i class="fas fa-link"></i></a>
</h2>
<p>在落入x区间位置上的y，设定函数（也可以调整方向，对落入y区间位置的每个x，设定函数）</p>
<div class="sourceCode" id="cb2056"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_depth_mm</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"summary_bin"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"bar"</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mean</span>, color <span class="op">=</span> <span class="st">"red"</span>, orientation <span class="op">=</span> <span class="st">'x'</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-108-1.png" width="672"></div>
<div class="sourceCode" id="cb2057"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_depth_mm</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary_bin</a></span><span class="op">(</span>   </span>
<span>    fun <span class="op">=</span> <span class="va">mean</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"bar"</span>,</span>
<span>    orientation <span class="op">=</span> <span class="st">'x'</span>     <span class="co"># bin on x axis, summary mean on y</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-109-1.png" width="672"></div>
<div class="sourceCode" id="cb2058"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_depth_mm</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary_bin</a></span><span class="op">(</span> </span>
<span>    fun <span class="op">=</span> <span class="va">mean</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"bar"</span>,</span>
<span>    orientation <span class="op">=</span> <span class="st">'y'</span>  </span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-110-1.png" width="672"></div>
<div class="sourceCode" id="cb2059"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_depth_mm</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"summary_bin"</span>,</span>
<span>    fun <span class="op">=</span> <span class="va">mean</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-111-1.png" width="672"></div>
<div class="sourceCode" id="cb2060"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_depth_mm</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary_bin</a></span><span class="op">(</span> </span>
<span>    fun <span class="op">=</span> <span class="va">mean</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"bar"</span>,</span>
<span>    orientation <span class="op">=</span> <span class="st">'y'</span>  <span class="co"># bin on y axis, summary mean on x</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-112-1.png" width="672"></div>
</div>
<div id="stat_function" class="section level2" number="25.18">
<h2>
<span class="header-section-number">25.18</span> stat_function()<a class="anchor" aria-label="anchor" href="#stat_function"><i class="fas fa-link"></i></a>
</h2>
<p>函数曲线</p>
<p><code>Computed variables</code></p>
<ul>
<li>x: x values along a grid</li>
<li>y: value of the function evaluated at corresponding x</li>
</ul>
<p><code>默认几何形状</code></p>
<ul>
<li>geom_line()</li>
</ul>
<p><code>适用几何形状</code></p>
<ul>
<li>geom_line() / geom_point() /geom_function()</li>
</ul>
<div class="sourceCode" id="cb2061"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">5</span>, max <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"function"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dnorm</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-113-1.png" width="672"></div>
<div class="sourceCode" id="cb2062"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">5</span>, max <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"function"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fun <span class="op">=</span>  <span class="op">~</span> <span class="fl">0.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-114-1.png" width="672"></div>
</div>
<div id="stat_spoke" class="section level2" number="25.19">
<h2>
<span class="header-section-number">25.19</span> stat_spoke()<a class="anchor" aria-label="anchor" href="#stat_spoke"><i class="fas fa-link"></i></a>
</h2>
<p>将角度和半径转换为xend和yend，可以看作是<code><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment()</a></code>另外一种形式</p>
<div class="sourceCode" id="cb2063"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="va">flipper_length_mm</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span> <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"identity"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"spoke"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="va">angle</span><span class="op">)</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>radius <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-115-1.png" width="672"></div>
<div class="sourceCode" id="cb2064"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="va">flipper_length_mm</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span> <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_spoke.html">geom_spoke</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="va">angle</span><span class="op">)</span>,</span>
<span>    radius <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-116-1.png" width="672"></div>
</div>
<div id="stat_quantile" class="section level2" number="25.20">
<h2>
<span class="header-section-number">25.20</span> stat_quantile()<a class="anchor" aria-label="anchor" href="#stat_quantile"><i class="fas fa-link"></i></a>
</h2>
<p>分位数回归</p>
<div class="sourceCode" id="cb2065"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">quantreg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/quantreg/man/rq.html">rq</a></span><span class="op">(</span><span class="va">bill_depth_mm</span> <span class="op">~</span> <span class="va">bill_length_mm</span>, </span>
<span>             data <span class="op">=</span> <span class="va">penguins</span>,</span>
<span>             tau <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span></span>
<span>             <span class="op">)</span></span></code></pre></div>
<p><code>Computed variables</code></p>
<ul>
<li>quantile: quantile of distribution</li>
</ul>
<p><code>默认几何形状</code></p>
<ul>
<li>geom_quantile()</li>
</ul>
<p><code>适用几何形状</code></p>
<ul>
<li>geom_line() / geom_point() / geom_quantile()</li>
</ul>
<div class="sourceCode" id="cb2066"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"quantile"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"quantile"</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code>## Smoothing formula not specified. Using: y ~ x</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-118-1.png" width="672"></div>
<div class="sourceCode" id="cb2068"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"quantile"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">quantile</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code>## Smoothing formula not specified. Using: y ~ x</code></pre>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-119-1.png" width="672"></div>
</div>
<div id="stat_summary_2d" class="section level2" number="25.21">
<h2>
<span class="header-section-number">25.21</span> stat_summary_2d()<a class="anchor" aria-label="anchor" href="#stat_summary_2d"><i class="fas fa-link"></i></a>
</h2>
<p>落在x和y(长方形)区域上, summary on z</p>
<p>文档说<code>stat_summary_2d() is a 2d variation of stat_summary().</code> 个人觉得不完全准确</p>
<ul>
<li><p>看参数stat_summary() 是对每一个<code>x</code>统计汇总summary，<strong>有多少个唯一的x, 就有多少个value</strong>.</p></li>
<li><p>而stat_summary_2d() 有 bin的参数，它是对落在(x，y)构成的具有一定binwidth的长方形区域内的<code>z</code>统计汇总. <strong>有多少个长方形，就有多少个value</strong>.</p></li>
</ul>
<p>离散变量是正确的，但对应连续变量不准确。</p>
<p><code>Aesthetics</code></p>
<ul>
<li>x: horizontal position</li>
<li>y: vertical position</li>
<li>z: value passed to the summary function</li>
</ul>
<p><code>Computed variables</code></p>
<ul>
<li>
<code>x, y</code> : Location</li>
<li>
<code>value</code> : Value of summary statistic.</li>
</ul>
<p><code>默认几何形状</code></p>
<ul>
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile()</a></code> for stat_summary_2d()<br>
</li>
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/geom_hex.html">geom_hex()</a></code> for stat_summary_hex()</li>
</ul>
<div class="sourceCode" id="cb2070"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span>, z <span class="op">=</span> <span class="va">body_mass_g</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"summary_2d"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"tile"</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">.x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span> </span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-120-1.png" width="672"></div>
<div class="sourceCode" id="cb2071"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span>, z <span class="op">=</span> <span class="va">body_mass_g</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary_2d.html">stat_summary_2d</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>    fun <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">.x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,  <span class="co"># summary statistic for z</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> </span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-121-1.png" width="672"></div>
<div id="测试" class="section level3" number="25.21.1">
<h3>
<span class="header-section-number">25.21.1</span> 测试<a class="anchor" aria-label="anchor" href="#%E6%B5%8B%E8%AF%95"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb2072"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, <span class="va">bill_depth_mm</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 329 × 2
##    bill_length_mm bill_depth_mm
##             &lt;dbl&gt;         &lt;dbl&gt;
##  1           39.1          18.7
##  2           39.5          17.4
##  3           40.3          18  
##  4           36.7          19.3
##  5           39.3          20.6
##  6           38.9          17.8
##  7           39.2          19.6
##  8           41.1          17.6
##  9           38.6          21.2
## 10           34.6          21.1
## # ℹ 319 more rows</code></pre>
<p>说明有4个重叠的点。</p>
<p><code>sum</code>是一个点一个位置</p>
<div class="sourceCode" id="cb2074"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"text"</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"sum"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-123-1.png" width="672"></div>
<p><code>bin_2d</code>是一个bin一个统计</p>
<div class="sourceCode" id="cb2075"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"text"</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"bin_2d"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">stage</a></span><span class="op">(</span><span class="cn">NULL</span>, after_stat <span class="op">=</span> <span class="va">count</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-124-1.png" width="672"></div>
<p><code>stat_summary_2d</code>也是<strong>一个bin</strong>一个位置</p>
<div class="sourceCode" id="cb2076"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span>, z <span class="op">=</span> <span class="va">body_mass_g</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary_2d.html">stat_summary_2d</a></span><span class="op">(</span></span>
<span>    fun <span class="op">=</span> <span class="va">n_fun</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"text"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-125-1.png" width="672"></div>
</div>
</div>
<div id="stat_summary_hex" class="section level2" number="25.22">
<h2>
<span class="header-section-number">25.22</span> stat_summary_hex()<a class="anchor" aria-label="anchor" href="#stat_summary_hex"><i class="fas fa-link"></i></a>
</h2>
<p>落在x和y(六边形)区域上, summary on z</p>
<div class="sourceCode" id="cb2077"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span>, z <span class="op">=</span> <span class="va">body_mass_g</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"summary_hex"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"tile"</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">.x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, binwidth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span> </span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-126-1.png" width="672"></div>
<div class="sourceCode" id="cb2078"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">bill_depth_mm</span>, z <span class="op">=</span> <span class="va">body_mass_g</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary_2d.html">stat_summary_hex</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"tile"</span>,</span>
<span>    fun <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">.x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,         <span class="co"># summary statistic for z</span></span>
<span>    binwidth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.2</span><span class="op">)</span>     <span class="co"># Numeric vector giving bin width in both vertical and horizontal directions</span></span>
<span>  <span class="op">)</span> </span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-127-1.png" width="672"></div>
</div>
<div id="stat_contour-and-stat_contour_filled" class="section level2" number="25.23">
<h2>
<span class="header-section-number">25.23</span> stat_contour() and stat_contour_filled()<a class="anchor" aria-label="anchor" href="#stat_contour-and-stat_contour_filled"><i class="fas fa-link"></i></a>
</h2>
<p>等高线、等高面，需要提供x,y,z映射</p>
<p><code>Computed variables</code></p>
<ul>
<li>level: Height of contour. For contour lines, this is numeric vector that represents bin boundaries. For contour bands, this is an ordered factor that represents bin ranges.</li>
<li>level_low: level_high, level_mid (contour bands only) Lower and upper bin boundaries for each band, as well the mid point between the boundaries.</li>
<li>nlevel: Height of contour, scaled to maximum of 1.</li>
<li>piece: Contour piece (an integer).</li>
</ul>
<p><code>默认几何形状</code></p>
<ul>
<li>geom_contour() / geom_contour_filled()</li>
</ul>
<p><code>适用几何形状</code></p>
<ul>
<li>geom_contour() / geom_contour_filled()</li>
</ul>
<div class="sourceCode" id="cb2079"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    flipper_length_mm <span class="op">=</span> <span class="va">flipper_length_mm</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%/%</a></span> <span class="fl">10</span>,</span>
<span>    body_mass_g <span class="op">=</span> <span class="va">body_mass_g</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%/%</a></span> <span class="fl">10</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">flipper_length_mm</span>, y <span class="op">=</span> <span class="va">body_mass_g</span>, z <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="st">"contour"</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"path"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">level</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-128-1.png" width="672"></div>
<div class="sourceCode" id="cb2080"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    flipper_length_mm <span class="op">=</span> <span class="va">flipper_length_mm</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%/%</a></span> <span class="fl">10</span>,</span>
<span>    body_mass_g <span class="op">=</span> <span class="va">body_mass_g</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%/%</a></span> <span class="fl">10</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">flipper_length_mm</span>, y <span class="op">=</span> <span class="va">body_mass_g</span>, z <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html">stat_contour</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"path"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">level</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-129-1.png" width="672"></div>
<div class="sourceCode" id="cb2081"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    flipper_length_mm <span class="op">=</span> <span class="va">flipper_length_mm</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%/%</a></span> <span class="fl">10</span>,</span>
<span>    body_mass_g <span class="op">=</span> <span class="va">body_mass_g</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%/%</a></span> <span class="fl">10</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">flipper_length_mm</span>, y <span class="op">=</span> <span class="va">body_mass_g</span>, z <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html">geom_contour</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">level</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-130-1.png" width="672"></div>
</div>
<div id="课后作业" class="section level2" number="25.24">
<h2>
<span class="header-section-number">25.24</span> 课后作业<a class="anchor" aria-label="anchor" href="#%E8%AF%BE%E5%90%8E%E4%BD%9C%E4%B8%9A"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>写成对应的<code>stat_***()</code> 版本和<code>geom_***()</code>版本</li>
</ul>
<div class="sourceCode" id="cb2082"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">penguins</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer</a></span><span class="op">(</span></span>
<span>      data       <span class="op">=</span> <span class="va">penguins</span>,</span>
<span>      mapping    <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span>, color <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      stat       <span class="op">=</span> <span class="st">"summary"</span>, </span>
<span>      params     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span>,</span>
<span>      geom       <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>      position   <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-131-1.png" width="672"></div>
<ul>
<li>写出对应的<code>stat_***()</code> 版本和<code><a href="https://ggplot2.tidyverse.org/reference/layer.html">layer()</a></code>版本</li>
</ul>
<div class="sourceCode" id="cb2083"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">island</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_count.html">geom_count</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span></code></pre></div>
<div class="inline-figure"><img src="tidyverse_ggplot2_from_layer_to_geom_files/figure-html/unnamed-chunk-133-1.png" width="672"></div>
<ul>
<li>上题用layer写，但要求不用<code>stat = "sum"</code>, 而用<code>stat = "summary"</code>
</li>
</ul>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="tidyverse-ggplot2-stat-layer.html"><span class="header-section-number">24</span> ggplot2之统计图层</a></div>
<div class="next"><a href="tidyverse-ggplot2-colors.html"><span class="header-section-number">26</span> ggplot2之数据可视化中的配色</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#tidyverse-ggplot2-from-layer-to-geom"><span class="header-section-number">25</span> ggplot2之从图层到几何形状</a></li>
<li><a class="nav-link" href="#%E5%9B%BE%E5%B1%82%E7%9A%84%E4%BA%94%E5%A4%A7%E5%85%83%E7%B4%A0"><span class="header-section-number">25.1</span> 图层的五大元素</a></li>
<li><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD%E5%AE%8F%E5%8C%85"><span class="header-section-number">25.2</span> 加载宏包</a></li>
<li><a class="nav-link" href="#stat_identity"><span class="header-section-number">25.3</span> stat_identity()</a></li>
<li><a class="nav-link" href="#stat_count"><span class="header-section-number">25.4</span> stat_count()</a></li>
<li><a class="nav-link" href="#stat_bin"><span class="header-section-number">25.5</span> stat_bin()</a></li>
<li><a class="nav-link" href="#stat_density"><span class="header-section-number">25.6</span> stat_density()</a></li>
<li><a class="nav-link" href="#stat_boxplot"><span class="header-section-number">25.7</span> stat_boxplot()</a></li>
<li><a class="nav-link" href="#stat_ydensity"><span class="header-section-number">25.8</span> stat_ydensity()</a></li>
<li><a class="nav-link" href="#stat_bindot"><span class="header-section-number">25.9</span> stat_bindot()</a></li>
<li><a class="nav-link" href="#stat_sum"><span class="header-section-number">25.10</span> stat_sum()</a></li>
<li><a class="nav-link" href="#stat_smooth"><span class="header-section-number">25.11</span> stat_smooth()</a></li>
<li><a class="nav-link" href="#stat_bin_2d"><span class="header-section-number">25.12</span> stat_bin_2d()</a></li>
<li><a class="nav-link" href="#stat_bin_hex"><span class="header-section-number">25.13</span> stat_bin_hex()</a></li>
<li>
<a class="nav-link" href="#stat_density_2d"><span class="header-section-number">25.14</span> stat_density_2d()</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E5%85%88%E7%9C%8B%E7%9C%8B%E6%9C%89%E7%AD%89%E9%AB%98%E7%BA%BF%E7%9A%84%E6%83%85%E5%BD%A2"><span class="header-section-number">25.14.1</span> 先看看有等高线的情形</a></li>
<li><a class="nav-link" href="#%E7%9C%8B%E7%9C%8B%E6%97%A0%E7%AD%89%E9%AB%98%E7%BA%BF%E7%9A%84%E6%83%85%E5%BD%A2"><span class="header-section-number">25.14.2</span> 看看无等高线的情形</a></li>
</ul>
</li>
<li><a class="nav-link" href="#stat_ellipse"><span class="header-section-number">25.15</span> stat_ellipse()</a></li>
<li>
<a class="nav-link" href="#stat_summary"><span class="header-section-number">25.16</span> stat_summary</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0-1"><span class="header-section-number">25.16.1</span> 自定义函数</a></li>
<li><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E6%96%87%E6%9C%AC"><span class="header-section-number">25.16.2</span> 添加文本</a></li>
<li><a class="nav-link" href="#%E6%9B%B4%E5%A4%9A-1"><span class="header-section-number">25.16.3</span> 更多</a></li>
</ul>
</li>
<li><a class="nav-link" href="#stat_summary_bin"><span class="header-section-number">25.17</span> stat_summary_bin</a></li>
<li><a class="nav-link" href="#stat_function"><span class="header-section-number">25.18</span> stat_function()</a></li>
<li><a class="nav-link" href="#stat_spoke"><span class="header-section-number">25.19</span> stat_spoke()</a></li>
<li><a class="nav-link" href="#stat_quantile"><span class="header-section-number">25.20</span> stat_quantile()</a></li>
<li>
<a class="nav-link" href="#stat_summary_2d"><span class="header-section-number">25.21</span> stat_summary_2d()</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#%E6%B5%8B%E8%AF%95"><span class="header-section-number">25.21.1</span> 测试</a></li></ul>
</li>
<li><a class="nav-link" href="#stat_summary_hex"><span class="header-section-number">25.22</span> stat_summary_hex()</a></li>
<li><a class="nav-link" href="#stat_contour-and-stat_contour_filled"><span class="header-section-number">25.23</span> stat_contour() and stat_contour_filled()</a></li>
<li><a class="nav-link" href="#%E8%AF%BE%E5%90%8E%E4%BD%9C%E4%B8%9A"><span class="header-section-number">25.24</span> 课后作业</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R编程与作图</strong>" was written by Suoqin Jin. It was last built on 2023-11-22.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
